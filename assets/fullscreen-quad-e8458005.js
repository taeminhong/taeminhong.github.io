var St=Object.defineProperty;var Nt=(e,t,r)=>t in e?St(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var c=(e,t,r)=>(Nt(e,typeof t!="symbol"?t+"":t,r),r);var ft=1e-6,N=typeof Float32Array<"u"?Float32Array:Array;function It(e,t){return Math.abs(e-t)<=ft*Math.max(1,Math.abs(e),Math.abs(t))}Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});function mt(){var e=new N(9);return N!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function xt(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e}function Lt(e,t,r,s,n,i,a,o,h){var m=new N(9);return m[0]=e,m[1]=t,m[2]=r,m[3]=s,m[4]=n,m[5]=i,m[6]=a,m[7]=o,m[8]=h,m}function Ce(e,t,r){var s=t[0],n=t[1],i=t[2],a=t[3],o=t[4],h=t[5],m=t[6],f=t[7],l=t[8],u=r[0],d=r[1];return e[0]=s,e[1]=n,e[2]=i,e[3]=a,e[4]=o,e[5]=h,e[6]=u*s+d*a+m,e[7]=u*n+d*o+f,e[8]=u*i+d*h+l,e}function ze(e,t,r){var s=r[0],n=r[1];return e[0]=s*t[0],e[1]=s*t[1],e[2]=s*t[2],e[3]=n*t[3],e[4]=n*t[4],e[5]=n*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function Be(e,t){var r=t[0],s=t[1],n=t[2],i=t[3],a=r+r,o=s+s,h=n+n,m=r*a,f=s*a,l=s*o,u=n*a,d=n*o,_=n*h,A=i*a,b=i*o,p=i*h;return e[0]=1-l-_,e[3]=f-p,e[6]=u+b,e[1]=f+p,e[4]=1-m-_,e[7]=d-A,e[2]=u-b,e[5]=d+A,e[8]=1-m-l,e}function Ge(e,t){var r=t[0],s=t[1],n=t[2],i=t[3],a=t[4],o=t[5],h=t[6],m=t[7],f=t[8],l=t[9],u=t[10],d=t[11],_=t[12],A=t[13],b=t[14],p=t[15],S=r*o-s*a,T=r*h-n*a,w=r*m-i*a,v=s*h-n*o,M=s*m-i*o,U=n*m-i*h,g=f*A-l*_,F=f*b-u*_,R=f*p-d*_,V=l*b-u*A,O=l*p-d*A,D=u*p-d*b,y=S*D-T*O+w*V+v*R-M*F+U*g;return y?(y=1/y,e[0]=(o*D-h*O+m*V)*y,e[1]=(h*R-a*D-m*F)*y,e[2]=(a*O-o*R+m*g)*y,e[3]=(n*O-s*D-i*V)*y,e[4]=(r*D-n*R+i*F)*y,e[5]=(s*R-r*O-i*g)*y,e[6]=(A*U-b*M+p*v)*y,e[7]=(b*w-_*U-p*T)*y,e[8]=(_*M-A*w+p*S)*y,e):null}function C(){var e=new N(16);return N!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function Rt(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function J(e,t){var r=t[0],s=t[1],n=t[2],i=t[3],a=t[4],o=t[5],h=t[6],m=t[7],f=t[8],l=t[9],u=t[10],d=t[11],_=t[12],A=t[13],b=t[14],p=t[15],S=r*o-s*a,T=r*h-n*a,w=r*m-i*a,v=s*h-n*o,M=s*m-i*o,U=n*m-i*h,g=f*A-l*_,F=f*b-u*_,R=f*p-d*_,V=l*b-u*A,O=l*p-d*A,D=u*p-d*b,y=S*D-T*O+w*V+v*R-M*F+U*g;return y?(y=1/y,e[0]=(o*D-h*O+m*V)*y,e[1]=(n*O-s*D-i*V)*y,e[2]=(A*U-b*M+p*v)*y,e[3]=(u*M-l*U-d*v)*y,e[4]=(h*R-a*D-m*F)*y,e[5]=(r*D-n*R+i*F)*y,e[6]=(b*w-_*U-p*T)*y,e[7]=(f*U-u*w+d*T)*y,e[8]=(a*O-o*R+m*g)*y,e[9]=(s*R-r*O-i*g)*y,e[10]=(_*M-A*w+p*S)*y,e[11]=(l*w-f*M-d*S)*y,e[12]=(o*F-a*V-h*g)*y,e[13]=(r*V-s*F+n*g)*y,e[14]=(A*T-_*v-b*S)*y,e[15]=(f*v-l*T+u*S)*y,e):null}function lt(e,t,r){var s=t[0],n=t[1],i=t[2],a=t[3],o=t[4],h=t[5],m=t[6],f=t[7],l=t[8],u=t[9],d=t[10],_=t[11],A=t[12],b=t[13],p=t[14],S=t[15],T=r[0],w=r[1],v=r[2],M=r[3];return e[0]=T*s+w*o+v*l+M*A,e[1]=T*n+w*h+v*u+M*b,e[2]=T*i+w*m+v*d+M*p,e[3]=T*a+w*f+v*_+M*S,T=r[4],w=r[5],v=r[6],M=r[7],e[4]=T*s+w*o+v*l+M*A,e[5]=T*n+w*h+v*u+M*b,e[6]=T*i+w*m+v*d+M*p,e[7]=T*a+w*f+v*_+M*S,T=r[8],w=r[9],v=r[10],M=r[11],e[8]=T*s+w*o+v*l+M*A,e[9]=T*n+w*h+v*u+M*b,e[10]=T*i+w*m+v*d+M*p,e[11]=T*a+w*f+v*_+M*S,T=r[12],w=r[13],v=r[14],M=r[15],e[12]=T*s+w*o+v*l+M*A,e[13]=T*n+w*h+v*u+M*b,e[14]=T*i+w*m+v*d+M*p,e[15]=T*a+w*f+v*_+M*S,e}function Ot(e,t,r,s){var n=t[0],i=t[1],a=t[2],o=t[3],h=n+n,m=i+i,f=a+a,l=n*h,u=n*m,d=n*f,_=i*m,A=i*f,b=a*f,p=o*h,S=o*m,T=o*f,w=s[0],v=s[1],M=s[2];return e[0]=(1-(_+b))*w,e[1]=(u+T)*w,e[2]=(d-S)*w,e[3]=0,e[4]=(u-T)*v,e[5]=(1-(l+b))*v,e[6]=(A+p)*v,e[7]=0,e[8]=(d+S)*M,e[9]=(A-p)*M,e[10]=(1-(l+_))*M,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function Dt(e,t,r,s,n){var i=1/Math.tan(t/2),a;return e[0]=i/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,n!=null&&n!==1/0?(a=1/(s-n),e[10]=(n+s)*a,e[14]=2*n*s*a):(e[10]=-1,e[14]=-2*s),e}var Pt=Dt,Ut=lt;function P(){var e=new N(3);return N!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function rt(e){var t=new N(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function gt(e){var t=e[0],r=e[1],s=e[2];return Math.hypot(t,r,s)}function L(e,t,r){var s=new N(3);return s[0]=e,s[1]=t,s[2]=r,s}function ke(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function Ft(e,t,r,s){return e[0]=t,e[1]=r,e[2]=s,e}function Vt(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e}function Ct(e,t){var r=t[0],s=t[1],n=t[2],i=r*r+s*s+n*n;return i>0&&(i=1/Math.sqrt(i)),e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e}function dt(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function Y(e,t,r){var s=t[0],n=t[1],i=t[2],a=r[0],o=r[1],h=r[2];return e[0]=n*h-i*o,e[1]=i*a-s*h,e[2]=s*o-n*a,e}function Et(e,t,r){var s=t[0],n=t[1],i=t[2],a=r[3]*s+r[7]*n+r[11]*i+r[15];return a=a||1,e[0]=(r[0]*s+r[4]*n+r[8]*i+r[12])/a,e[1]=(r[1]*s+r[5]*n+r[9]*i+r[13])/a,e[2]=(r[2]*s+r[6]*n+r[10]*i+r[14])/a,e}function zt(e,t,r){var s=t[0],n=t[1],i=t[2];return e[0]=s*r[0]+n*r[3]+i*r[6],e[1]=s*r[1]+n*r[4]+i*r[7],e[2]=s*r[2]+n*r[5]+i*r[8],e}var H=gt;(function(){var e=P();return function(t,r,s,n,i,a){var o,h;for(r||(r=3),s||(s=0),n?h=Math.min(n*r+s,t.length):h=t.length,o=s;o<h;o+=r)e[0]=t[o],e[1]=t[o+1],e[2]=t[o+2],i(e,e,a),t[o]=e[0],t[o+1]=e[1],t[o+2]=e[2];return t}})();function Bt(){var e=new N(4);return N!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function Gt(e,t){var r=t[0],s=t[1],n=t[2],i=t[3],a=r*r+s*s+n*n+i*i;return a>0&&(a=1/Math.sqrt(a)),e[0]=r*a,e[1]=s*a,e[2]=n*a,e[3]=i*a,e}(function(){var e=Bt();return function(t,r,s,n,i,a){var o,h;for(r||(r=4),s||(s=0),n?h=Math.min(n*r+s,t.length):h=t.length,o=s;o<h;o+=r)e[0]=t[o],e[1]=t[o+1],e[2]=t[o+2],e[3]=t[o+3],i(e,e,a),t[o]=e[0],t[o+1]=e[1],t[o+2]=e[2],t[o+3]=e[3];return t}})();function X(){var e=new N(4);return N!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function kt(e,t,r){r=r*.5;var s=Math.sin(r);return e[0]=s*t[0],e[1]=s*t[1],e[2]=s*t[2],e[3]=Math.cos(r),e}function $t(e,t,r){r*=.5;var s=t[0],n=t[1],i=t[2],a=t[3],o=Math.sin(r),h=Math.cos(r);return e[0]=s*h+a*o,e[1]=n*h+i*o,e[2]=i*h-n*o,e[3]=a*h-s*o,e}function Yt(e,t,r){r*=.5;var s=t[0],n=t[1],i=t[2],a=t[3],o=Math.sin(r),h=Math.cos(r);return e[0]=s*h-i*o,e[1]=n*h+a*o,e[2]=i*h+s*o,e[3]=a*h-n*o,e}function Ht(e,t,r){r*=.5;var s=t[0],n=t[1],i=t[2],a=t[3],o=Math.sin(r),h=Math.cos(r);return e[0]=s*h+n*o,e[1]=n*h-s*o,e[2]=i*h+a*o,e[3]=a*h-i*o,e}function j(e,t,r,s){var n=t[0],i=t[1],a=t[2],o=t[3],h=r[0],m=r[1],f=r[2],l=r[3],u,d,_,A,b;return d=n*h+i*m+a*f+o*l,d<0&&(d=-d,h=-h,m=-m,f=-f,l=-l),1-d>ft?(u=Math.acos(d),_=Math.sin(u),A=Math.sin((1-s)*u)/_,b=Math.sin(s*u)/_):(A=1-s,b=s),e[0]=A*n+b*h,e[1]=A*i+b*m,e[2]=A*a+b*f,e[3]=A*o+b*l,e}function At(e,t){var r=t[0]+t[4]+t[8],s;if(r>0)s=Math.sqrt(r+1),e[3]=.5*s,s=.5/s,e[0]=(t[5]-t[7])*s,e[1]=(t[6]-t[2])*s,e[2]=(t[1]-t[3])*s;else{var n=0;t[4]>t[0]&&(n=1),t[8]>t[n*3+n]&&(n=2);var i=(n+1)%3,a=(n+2)%3;s=Math.sqrt(t[n*3+n]-t[i*3+i]-t[a*3+a]+1),e[n]=.5*s,s=.5/s,e[3]=(t[i*3+a]-t[a*3+i])*s,e[i]=(t[i*3+n]+t[n*3+i])*s,e[a]=(t[a*3+n]+t[n*3+a])*s}return e}var bt=Gt;(function(){var e=P(),t=L(1,0,0),r=L(0,1,0);return function(s,n,i){var a=dt(n,i);return a<-.999999?(Y(e,t,n),H(e)<1e-6&&Y(e,r,n),Ct(e,e),kt(s,e,Math.PI),s):a>.999999?(s[0]=0,s[1]=0,s[2]=0,s[3]=1,s):(Y(e,n,i),s[0]=e[0],s[1]=e[1],s[2]=e[2],s[3]=1+a,bt(s,s))}})();(function(){var e=X(),t=X();return function(r,s,n,i,a,o){return j(e,s,a,o),j(t,n,i,o),j(r,e,t,2*o*(1-o)),r}})();(function(){var e=mt();return function(t,r,s,n){return e[0]=s[0],e[3]=s[1],e[6]=s[2],e[1]=n[0],e[4]=n[1],e[7]=n[2],e[2]=-r[0],e[5]=-r[1],e[8]=-r[2],bt(t,At(t,e))}})();function W(){var e=new N(2);return N!=Float32Array&&(e[0]=0,e[1]=0),e}function Q(e,t){var r=new N(2);return r[0]=e,r[1]=t,r}function Wt(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e}function Xt(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e}function $e(e,t,r){var s=t[0],n=t[1];return e[0]=r[0]*s+r[3]*n+r[6],e[1]=r[1]*s+r[4]*n+r[7],e}var st=Wt,qt=Xt;(function(){var e=W();return function(t,r,s,n,i,a){var o,h;for(r||(r=2),s||(s=0),n?h=Math.min(n*r+s,t.length):h=t.length,o=s;o<h;o+=r)e[0]=t[o],e[1]=t[o+1],i(e,e,a),t[o]=e[0],t[o+1]=e[1];return t}})();function tt(e){return Object.assign(Object.create(Object.getPrototypeOf(e)),e)}class jt{constructor(t,r,s){c(this,"gl");c(this,"target");this.gl=t,this.target=r,t.bindBuffer(r,s)}unbind(){this.gl.bindBuffer(this.target,null)}data(t,r,s,n){s===void 0?this.gl.bufferData(this.target,t,r):this.gl.bufferData(this.target,t,r,s,n)}vertexAttribPointer(t,r,s,n,i,a){this.gl.vertexAttribPointer(t,r,s,n,i,a),this.gl.enableVertexAttribArray(t)}}class nt{constructor(t,r){c(this,"buffer");c(this,"target");const s=t.createBuffer();this.buffer=s,this.target=r}bind(t){return new jt(t,this.target,this.buffer)}}class Qt{constructor(t,r){c(this,"gl");t.bindVertexArray(r),this.gl=t}unbind(){this.gl.bindVertexArray(null)}}class Jt{constructor(t){c(this,"vao");const r=t.createVertexArray();this.vao=r}bind(t){return new Qt(t,this.vao)}}function G(e,t){if(t instanceof Function)return t(e);if(typeof t!="boolean"||!t)throw e}class et extends Error{constructor(){super("Not implemented yet")}}function _t(e,t){switch(t){case e.INT:case e.BOOL:case e.FLOAT:return"scalar";case e.INT_VEC2:case e.INT_VEC3:case e.INT_VEC4:case e.BOOL_VEC2:case e.BOOL_VEC3:case e.BOOL_VEC4:case e.FLOAT_VEC2:case e.FLOAT_VEC3:case e.FLOAT_VEC4:return"vector";case e.FLOAT_MAT2:case e.FLOAT_MAT3:case e.FLOAT_MAT4:return"matrix";case e.SAMPLER_2D:case e.SAMPLER_CUBE:return"sampler";case e.UNSIGNED_INT:return"scalar";case e.UNSIGNED_INT_VEC2:case e.UNSIGNED_INT_VEC3:case e.UNSIGNED_INT_VEC4:return"vector";case e.FLOAT_MAT2x3:case e.FLOAT_MAT2x4:case e.FLOAT_MAT3x2:case e.FLOAT_MAT3x4:case e.FLOAT_MAT4x2:case e.FLOAT_MAT4x3:return"matrix";case e.SAMPLER_3D:case e.SAMPLER_2D_SHADOW:case e.SAMPLER_2D_ARRAY:case e.SAMPLER_2D_ARRAY_SHADOW:case e.SAMPLER_CUBE_SHADOW:case e.INT_SAMPLER_2D:case e.INT_SAMPLER_3D:case e.INT_SAMPLER_CUBE:case e.INT_SAMPLER_2D_ARRAY:case e.UNSIGNED_INT_SAMPLER_2D:case e.UNSIGNED_INT_SAMPLER_3D:case e.UNSIGNED_INT_SAMPLER_CUBE:case e.UNSIGNED_INT_SAMPLER_2D_ARRAY:return"sampler";default:throw new Error(`invalid uniform type: ${t}`)}}function Kt(e,t){switch(t){case e.INT:return 1;case e.BOOL:return 1;case e.FLOAT:return 1;case e.INT_VEC2:return 2;case e.BOOL_VEC2:return 2;case e.FLOAT_VEC2:return 2;case e.INT_VEC3:return 3;case e.BOOL_VEC3:return 3;case e.FLOAT_VEC3:return 3;case e.INT_VEC4:return 4;case e.BOOL_VEC4:return 4;case e.FLOAT_VEC4:return 4;case e.FLOAT_MAT2:return 4;case e.FLOAT_MAT3:return 9;case e.FLOAT_MAT4:return 16;case e.SAMPLER_2D:return 1;case e.SAMPLER_CUBE:return 1;case e.UNSIGNED_INT:return 1;case e.UNSIGNED_INT_VEC2:return 2;case e.UNSIGNED_INT_VEC3:return 3;case e.UNSIGNED_INT_VEC4:return 4;case e.FLOAT_MAT2x3:return 6;case e.FLOAT_MAT2x4:return 8;case e.FLOAT_MAT3x2:return 6;case e.FLOAT_MAT3x4:return 12;case e.FLOAT_MAT4x2:return 8;case e.FLOAT_MAT4x3:return 12;case e.SAMPLER_3D:return 1;case e.SAMPLER_2D_SHADOW:case e.SAMPLER_2D_ARRAY:case e.SAMPLER_2D_ARRAY_SHADOW:case e.SAMPLER_CUBE_SHADOW:case e.INT_SAMPLER_2D:case e.INT_SAMPLER_3D:case e.INT_SAMPLER_CUBE:case e.INT_SAMPLER_2D_ARRAY:case e.UNSIGNED_INT_SAMPLER_2D:case e.UNSIGNED_INT_SAMPLER_3D:case e.UNSIGNED_INT_SAMPLER_CUBE:case e.UNSIGNED_INT_SAMPLER_2D_ARRAY:throw new et;default:throw new Error(`Invalid uniform type: ${t}`)}}function wt(e,t,r){if(r=r||0,r<0||r+t.length>e.size)throw new Error("Invalid offset: "+r);for(let s=0;s<t.length;++s)e.set(t[s],r+s)}class K{constructor(t,r){c(this,"name");c(this,"type");c(this,"size");c(this,"location");c(this,"category");c(this,"numElements");c(this,"values");this.name=r.name,this.type=r.type,this.location=r.location,this.size=r.size,this.numElements=Kt(t,r.type),this.category=_t(t,r.type),this.values=Array(r.size*this.numElements),this.reset()}bind(t){switch(this.type){case t.FLOAT:return t.uniform1fv(this.location,this.values);case t.BOOL:return t.uniform1iv(this.location,this.values);case t.INT:return t.uniform1iv(this.location,this.values);case t.FLOAT_VEC2:return t.uniform2fv(this.location,this.values);case t.FLOAT_VEC3:return t.uniform3fv(this.location,this.values);case t.FLOAT_VEC4:return t.uniform4fv(this.location,this.values);case t.BOOL_VEC2:return t.uniform2iv(this.location,this.values);case t.INT_VEC2:return t.uniform2iv(this.location,this.values);case t.BOOL_VEC3:return t.uniform3iv(this.location,this.values);case t.INT_VEC3:return t.uniform3iv(this.location,this.values);case t.BOOL_VEC4:return t.uniform4iv(this.location,this.values);case t.INT_VEC4:return t.uniform4iv(this.location,this.values);case t.FLOAT_MAT2:return t.uniformMatrix2fv(this.location,!1,this.values);case t.FLOAT_MAT3:return t.uniformMatrix3fv(this.location,!1,this.values);case t.FLOAT_MAT4:return t.uniformMatrix4fv(this.location,!1,this.values);case t.SAMPLER_2D:return t.uniform1iv(this.location,this.values);case t.SAMPLER_CUBE:return t.uniform1iv(this.location,this.values);case t.UNSIGNED_INT:return t.uniform1uiv(this.location,this.values);case t.UNSIGNED_INT_VEC2:return t.uniform2uiv(this.location,this.values);case t.UNSIGNED_INT_VEC3:return t.uniform3uiv(this.location,this.values);case t.UNSIGNED_INT_VEC4:return t.uniform4uiv(this.location,this.values);case t.FLOAT_MAT2x3:case t.FLOAT_MAT2x4:case t.FLOAT_MAT3x2:case t.FLOAT_MAT3x4:case t.FLOAT_MAT4x2:case t.FLOAT_MAT4x3:case t.SAMPLER_3D:case t.SAMPLER_2D_SHADOW:case t.SAMPLER_2D_ARRAY:case t.SAMPLER_2D_ARRAY_SHADOW:case t.SAMPLER_CUBE_SHADOW:case t.INT_SAMPLER_2D:case t.INT_SAMPLER_3D:case t.INT_SAMPLER_CUBE:case t.INT_SAMPLER_2D_ARRAY:case t.UNSIGNED_INT_SAMPLER_2D:case t.UNSIGNED_INT_SAMPLER_3D:case t.UNSIGNED_INT_SAMPLER_CUBE:case t.UNSIGNED_INT_SAMPLER_2D_ARRAY:return}}set(t,r){switch(r=r||0,this.checkIndex(r),this.category){case"scalar":return this.setScalar(t,r);case"vector":return this.setVector(t,r);case"matrix":return this.setMatrix(t,r);case"sampler":return this.setScalar(t,r);default:throw new et}}setMany(t,r){wt(this,t,r)}reset(){if(this.values.fill(0),this.category==="vector"&&this.numElements===4)for(let t=0;t<this.size;++t)this.values[this.numElements*t+3]=1;else if(this.category==="matrix"&&this.numElements===16)for(let t=0;t<this.size;++t)this.values[this.numElements*t+15]=1}clone(){const t=tt(this);return t.values=this.values.slice(),t}get(t){return t=t||0,this.checkIndex(t),this.numElements===1?this.values[t]:this.values.slice(this.numElements*t,this.numElements)}checkIndex(t){if(t<0)throw new RangeError(`Negative index: ${t}`);if(t>=this.size)throw new RangeError(`Index should be less than ${this.size}, but ${t}`)}setScalar(t,r){if(typeof t=="number"||typeof t=="boolean")this.values[r]=Number(t);else throw new Error("Invalid type of argument")}setVector(t,r){let s;if(t instanceof Float32Array||t instanceof Int32Array||t instanceof Uint32Array)s=t;else if(Array.isArray(t))t.every(a=>typeof a=="number")?s=t:s=t.map(Number);else if(t&&typeof t=="object"&&Symbol.iterator in t)s=Array.from(t).map(Number);else throw new Error("Invalid type of argument");if(s.length===0)throw new Error("Expected at least one argument");const n=[0,0,0,1];for(let a=0;a<Math.min(s.length,4);++a)n[a]=s[a];n.length=this.numElements;const i=r*this.numElements;for(let a=0;a<this.numElements;++a)this.values[i+a]=n[a]}setMatrix(t,r){let s;if(t instanceof Float32Array)s=t;else if(Array.isArray(t))t.every(i=>typeof i=="number")?s=t:s=t.map(Number);else if(t&&typeof t=="object"&&Symbol.iterator in t)s=Array.from(t).map(Number);else throw new Error("Invalid type of argument");if(s.length!=this.numElements)throw new Error("Matrix size mismatch: expected ${this.numElements} but ${mat.length}");const n=r*this.numElements;for(let i=0;i<s.length;++i)this.values[n+i]=s[i]}}class it{constructor(t,r,s,n){c(this,"textureTarget");c(this,"textures");c(this,"realUniform");if(_t(t,r.type)!=="sampler")throw new Error("Invalid uniform info");const i=new K(t,r);for(let a=0;a<r.size;++a){const o=s.length;s.push(null),i.set(o,a)}this.realUniform=i,this.textures=s,this.textureTarget=n}set(t,r){if(t instanceof vt){if(t.target!==this.textureTarget){const s=WebGLDebugUtils.glEnumToString(this.textureTarget),n=WebGLDebugUtils.glEnumToString(t.target);throw new Error(`${s} expected, but got ${n}`)}this.textures[this.realUniform.get(r)]=t}else if(t===null)this.textures[this.realUniform.get(r)]=null;else throw new Error("A texture object was expected")}setMany(t,r){wt(this,t,r)}reset(){for(let t=0;t<this.size;++t)this.textures[this.realUniform.get(t)]=null}bind(t){for(let r=0;r<this.realUniform.size;++r){const s=this.realUniform.get(r);t.activeTexture(t.TEXTURE0+s);const n=this.textures[s];n?n.bind(t):t.bindTexture(this.textureTarget,null)}this.realUniform.bind(t)}clone(){const t=tt(this);return t.realUniform=this.realUniform.clone(),t}get(t){return this.textures[this.realUniform.get(t)]}get size(){return this.realUniform.size}get category(){return this.realUniform.category}get name(){return this.realUniform.name}get type(){return this.realUniform.type}get numElements(){return this.realUniform.numElements}get location(){return this.realUniform.location}}class Ye{constructor(t){c(this,"locators");this.locators=t}}function Zt(e,t,r,s){if(s.some(i=>i.shader===null)||!s.some(i=>i.type===e.VERTEX_SHADER)||!s.some(i=>i.type===e.FRAGMENT_SHADER))return null;const n=e.createProgram();if(!n)return null;for(const i of s)e.attachShader(n,i.shader);for(const i of r.locators)e.bindAttribLocation(n,i.location,i.name);if(e.linkProgram(n),!e.isContextLost()&&!e.getProgramParameter(n,e.LINK_STATUS)){const i=e.getProgramInfoLog(n)??"Program link failed.",a=`${t}: ${i}
`,o=s.map(h=>h.getInfoLog(e)).filter(h=>!!h);throw e.deleteProgram(n),new Error(a+o.join(`

`))}return n}function at(e,t){switch(t){case e.VERTEX_SHADER:return"vertex";case e.FRAGMENT_SHADER:return"fragment";default:throw new Error("Unkonw shader type code: "+t)}}function He(e,t){return new Tt(e,e.VERTEX_SHADER,t)}function We(e,t){return new Tt(e,e.FRAGMENT_SHADER,t)}class Tt{constructor(t,r,s){c(this,"shader");c(this,"type");c(this,"log");c(this,"source");at(t,r);const n=t.createShader(r);n&&(t.shaderSource(n,s),t.compileShader(n)),this.shader=n,this.type=r,this.log=null,this.source=s}getInfoLog(t){if(this.shader&&this.source){const r=t.getShaderInfoLog(this.shader);if(r){const s=at(t,this.type);this.log=`${s} shader
${r}${ae(this.source)}`}delete this.source}return this.log}}class Xe{constructor(t,r,s,...n){c(this,"name");c(this,"vertexModel");c(this,"program");c(this,"attributes");c(this,"uniforms");const i=new Map,a=new Map,o=Zt(t,r,s,n);if(o){const h=t.getProgramParameter(o,t.ACTIVE_ATTRIBUTES);for(let f=0;f<h;++f){const l=t.getActiveAttrib(o,f);if(l){const u=l.name,d=l.type,_=l.size,A=t.getAttribLocation(o,u),b=s.locators.find(p=>p.name===u);if((b==null?void 0:b.location)!==A)throw Error("program is not compatible with the given vertex model");a.set(u,{name:u,type:d,size:_,location:A,index:f})}}const m=t.getProgramParameter(o,t.ACTIVE_UNIFORMS);for(let f=0;f<m;++f){const l=t.getActiveUniform(o,f);if(l){const u=l.name,d=l.type,_=l.size,A=t.getUniformLocation(o,u);A&&i.set(u,{name:u,type:d,size:_,location:A,index:f})}}}this.program=o,this.uniforms=i,this.attributes=a,this.name=r,this.vertexModel=s}use(t){t.useProgram(this.program)}restore(t){t.useProgram(null)}getAttribLocation(t){const r=this.attributes.get(t);return r?r.location:-1}getUniformLocation(t){const r=this.uniforms.get(t);return r?r.location:null}getUniformInfos(){return Array.from(this.uniforms.values()).sort((t,r)=>t.index-r.index)}}function te(e,t,r){const s=e.bind(t);try{r(s)}finally{s.unbind()}}class ee{constructor(t,r,s){c(this,"gl");c(this,"target");this.gl=t,this.target=r,this.gl.bindTexture(this.target,s)}unbind(){this.gl.bindTexture(this.target,null)}generateMipmap(){return this.gl.generateMipmap(this.target),this}parameteri(t,r){return this.gl.texParameteri(this.target,t,r),this}}class vt{constructor(t,r,s,n){c(this,"texture");c(this,"target");c(this,"levels");c(this,"internalFormat");if(s<=0)throw new RangeError(`Invalid number of levels: ${s}`);this.texture=t.createTexture(),this.target=r,this.internalFormat=n,this.levels=s}swap(t){if(this.constructor!==t.constructor)throw new Error("Can't swap objects of two distinct types");[this.texture,t.texture]=[t.texture,this.texture],[this.target,t.target]=[t.target,this.target],[this.levels,t.levels]=[t.levels,this.levels],[this.internalFormat,t.internalFormat]=[t.internalFormat,this.internalFormat]}}function ot(e,t){for(let r=0;r<t;++r)e=Math.floor(e/2);return Math.max(1,e)}class re extends ee{constructor(t,r,s){super(t,r,s)}subImage2D(...t){return this.gl.texSubImage2D(...t),this}subImageCube(...t){if(this.target!==this.gl.TEXTURE_CUBE_MAP)throw new Error(`Invalid target for subImageCube: ${this.target}`);const r=[t.pop()].flat();for(let s=0;s<6;++s){const n=r[s%r.length];this.gl.texSubImage2D(this.gl.TEXTURE_CUBE_MAP_POSITIVE_X+s,...t,n)}return this}}class qe extends vt{constructor(r,s,n,i,a,o){super(r,s,n,i);c(this,"width");c(this,"height");r.bindTexture(this.target,this.texture),r.texStorage2D(this.target,n,i,a,o),r.bindTexture(this.target,null),this.width=a,this.height=o}swap(r){super.swap(r),[this.width,r.width]=[r.width,this.width],[this.height,r.height]=[r.height,this.height]}bind(r){return new re(r,this.target,this.texture)}}class se{constructor(t,r){c(this,"gl");c(this,"framebuffer");t.bindFramebuffer(r.target,r.framebuffer),this.gl=t,this.framebuffer=r}texture2D(t,r,s,n){if(this.gl.framebufferTexture2D(this.framebuffer.target,t,r,(s==null?void 0:s.texture)||null,n),s){const i=ot(s.width,n),a=ot(s.height,n);this.framebuffer.attachments.set(t,{size:{width:i,height:a}})}else this.framebuffer.attachments.delete(t);return this}checkStatus(t){return t(this.gl.checkFramebufferStatus(this.framebuffer.target)),this}drawBuffers(...t){return this.gl.drawBuffers(t),this}readPixels(...t){this.gl.readPixels(...t)}unbind(){this.gl.bindFramebuffer(this.framebuffer.target,null)}}class je{constructor(t,r){c(this,"framebuffer");c(this,"target");c(this,"attachments");this.framebuffer=t.createFramebuffer(),this.target=r,this.attachments=new Map}bind(t){return new se(t,this)}get size(){const t={width:0,height:0};return this.attachments.size==0?t:Array.from(this.attachments.values()).map(s=>s.size).reduce((s,n)=>s.width===n.width&&s.height===n.height?s:t)}}function ne(e,t){switch(t){case e.NO_ERROR:return"No error";case e.INVALID_ENUM:return"Invalid enum";case e.INVALID_VALUE:return"Invalid value";case e.INVALID_OPERATION:return"Invalid operation";case e.INVALID_FRAMEBUFFER_OPERATION:return"Invalid framebuffer operation";case e.OUT_OF_MEMORY:return"Out of memory";case e.CONTEXT_LOST_WEBGL:return"Conext lost";case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"Framebuffer incomplete attachment";case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"Framebuffer incomplete missing attachment";case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"Framebuffer incomplete dimensions";case e.FRAMEBUFFER_UNSUPPORTED:return"Framebuffer unsupported";case e.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE:return"Framebuffer incomplete multisample";default:return`Unknwon error: ${t}`}}function ie(e,t){switch(t){case e.BYTE:return 1;case e.UNSIGNED_BYTE:return 1;case e.SHORT:return 2;case e.UNSIGNED_SHORT:return 2;case e.INT:return 4;case e.UNSIGNED_INT:return 4;case e.FLOAT:return 4;default:throw new Error("Unknown type")}}class Qe extends Error{constructor(t,r){super(ne(t,r))}}function ae(e,t){function r(i,a,o,h){return String(a+1).padStart(o," ")+h+i}const s=e.split(`
`),n=String(s.length).length;return s.map((i,a)=>r(i,a,n,": ")).join(`
`)}function oe(e,t,r){switch(t.type){case e.INT:case e.BOOL:case e.FLOAT:case e.INT_VEC2:case e.INT_VEC3:case e.INT_VEC4:case e.BOOL_VEC2:case e.BOOL_VEC3:case e.BOOL_VEC4:case e.FLOAT_VEC2:case e.FLOAT_VEC3:case e.FLOAT_VEC4:case e.FLOAT_MAT2:case e.FLOAT_MAT3:case e.FLOAT_MAT4:return new K(e,t);case e.SAMPLER_2D:return new it(e,t,r,e.TEXTURE_2D);case e.SAMPLER_CUBE:return new it(e,t,r,e.TEXTURE_CUBE_MAP);case e.UNSIGNED_INT:case e.UNSIGNED_INT_VEC2:case e.UNSIGNED_INT_VEC3:case e.UNSIGNED_INT_VEC4:return new K(e,t);case e.FLOAT_MAT2x3:case e.FLOAT_MAT2x4:case e.FLOAT_MAT3x2:case e.FLOAT_MAT3x4:case e.FLOAT_MAT4x2:case e.FLOAT_MAT4x3:case e.SAMPLER_3D:case e.SAMPLER_2D_SHADOW:case e.SAMPLER_2D_ARRAY:case e.SAMPLER_2D_ARRAY_SHADOW:case e.SAMPLER_CUBE_SHADOW:case e.INT_SAMPLER_2D:case e.INT_SAMPLER_3D:case e.INT_SAMPLER_CUBE:case e.INT_SAMPLER_2D_ARRAY:case e.UNSIGNED_INT_SAMPLER_2D:case e.UNSIGNED_INT_SAMPLER_3D:case e.UNSIGNED_INT_SAMPLER_CUBE:case e.UNSIGNED_INT_SAMPLER_2D_ARRAY:default:throw new et}}class Je{constructor(t,r,s){c(this,"name");c(this,"program");c(this,"uniforms");c(this,"textures");c(this,"queue");const n=new Map,i=[];for(const o of r.getUniformInfos())n.set(o.name,oe(t,o,i));const a=Object.entries((s==null?void 0:s.aliases)||{});this.name=(s==null?void 0:s.name)??r.name,this.queue=(s==null?void 0:s.queue)??0,this.program=r,this.uniforms=n,this.textures=i;for(const[o,h]of a)if(!this.addAlias(o,h)&&!(s!=null&&s.quiet))throw new Error(`No such uniform: ${h}`);this.setUniformValues((s==null?void 0:s.uniforms)??{},s==null?void 0:s.quiet)}use(t){this.program.use(t);for(const r of this.uniforms.values())r.bind(t)}restore(t){this.program.restore(t)}addAlias(t,r){const s=this.uniforms.get(r);return s&&this.uniforms.set(t,s),s}removeAlias(t){const r=this.uniforms.get(t);if(r&&r.name!==t)return this.uniforms.delete(t),r}*getAliases(){for(const[t,r]of this.uniforms.entries())r.name!==t&&(yield[t,r.name])}getUniform(t){return this.uniforms.get(t)}*getUniforms(t=!1){for(const[r,s]of this.uniforms.entries())(t||s.name===r)&&(yield s)}setUniformValue(t,r,s,n){const i=/^(.*)\[(\d+)\]$/,a=t.match(i);if(s===void 0)if(a)s=Number(a[2]),isNaN(s)&&G(new Error(`Invalid uniform name: ${t}`),n),s===0?this.doSetUniformValue(t,r,0,n):this.doSetUniformValue(a[1]+"[0]",r,s,n);else if(Array.isArray(r)&&this.uniforms.has(t+"[0]"))for(let o=0;o<r.length;++o)this.doSetUniformValue(t+"[0]",r[o],o,n);else this.doSetUniformValue(t,r,0,n);else a&&G(new Error("Invalid call: given a redundant index"),n),this.uniforms.has(t+"[0]")?this.doSetUniformValue(t+"[0]",r,s,n):s===0?this.doSetUniformValue(t,r,0,n):G(new Error(`${t} is not an array`),n)}setUniformValues(t,r){for(const s in t)this.setUniformValue(s,t[s],void 0,r)}clone(t){const r=tt(this);r.textures=this.textures.slice(),r.name=(t==null?void 0:t.name)??this.name,r.queue=(t==null?void 0:t.queue)??this.queue,r.uniforms=new Map;for(const[s,n]of this.uniforms)r.uniforms.set(s,n.clone());return r.setUniformValues((t==null?void 0:t.uniforms)??{},t==null?void 0:t.quiet),r}doSetUniformValue(t,r,s,n){const i=this.uniforms.get(t);i?i.set(r,s):G(new Error(`No such uniform: ${t}`),n)}}function Ke(e,t){const r={};for(const n in t.attributes){const i=t.attributes[n],a=new nt(e,e.ARRAY_BUFFER);a.bind(e).data(i.buffer,e.STATIC_DRAW),r[n]={...i,buffer:a}}let s;if(t.indices){const n=t.indices,i=new nt(e,e.ELEMENT_ARRAY_BUFFER);i.bind(e).data(n.buffer,e.STATIC_DRAW),s={...n,buffer:i}}return{...t,attributes:r,indices:s}}class Ze{constructor(t,r,s){c(this,"geometry");c(this,"subMeshes");c(this,"vertexModel");c(this,"vao");var a;const n=r.segments||[{offset:0,count:((a=r.indices)==null?void 0:a.count)??ce(r)}],i=new Jt(t);te(i,t,o=>{for(const[h,m]of Object.entries(r.attributes)){const f=s.locators.find(l=>l.name===h);f&&m.buffer.bind(t).vertexAttribPointer(f.location,m.size||1,m.type,!!m.normalized,m.stride||0,m.offset||0)}r.indices&&r.indices.buffer.bind(t)}),this.geometry=r,this.subMeshes=n,this.vertexModel=s,this.vao=i}draw(t,r){const s=this.vao.bind(t),n=this.subMeshes[r],i=this.geometry.indices;if(i){const a=(i.offset||0)+n.offset*ie(t,i.type);t.drawElements(this.geometry.drawMode,n.count,i.type,a)}else t.drawArrays(this.geometry.drawMode,n.offset,n.count);s.unbind()}}function ce(e){const t=Object.values(e.attributes).map(r=>r.count);if(!t.length)throw new Error("No attributes are given");if(!t.every(r=>r===t[0]))throw new Error("All attributes must have the same count");return t[0]}function ct(e){return e/180*Math.PI}function he(e){return e/Math.PI*180}function k(e,t,r){return Math.max(t,Math.min(e,r))}class z{constructor(t,r,s,n){c(this,"x");c(this,"y");c(this,"w");c(this,"h");this.x=t,this.y=r,this.w=s,this.h=n}denormalize(t,r){return new z(this.x*t,this.y*r,this.w*t,this.h*r)}validate(){let t=this.x,r=this.y,s=this.w,n=this.h;return s<0&&([t,s]=[t+s,-s]),n<0&&([r,n]=[r+n,-n]),new z(t,r,s,n)}clip(t){let r=k(this.left,t.left,t.right),s=k(this.bottom,t.bottom,t.top),n=k(this.right,t.left,t.right),i=k(this.top,t.bottom,t.top);return new z(r,s,n-r,i-s)}map(t){return new z(t(this.x),t(this.y),t(this.w),t(this.h))}get right(){return this.x+this.w}get top(){return this.y+this.h}get left(){return this.x}get bottom(){return this.y}get aspectRatio(){return this.w/this.h}}class q{constructor(t,r){c(this,"value");r==="deg"?this.value=ct(t):this.value=t}static rad(t){return new q(t,"rad")}static deg(t){return new q(t,"deg")}fromRad(t){this.value=t}fromDeg(t){this.value=ct(t)}toRad(){return this.value}toDeg(){return he(this.value)}}function ue(e,t,r){const s=X();return Yt(s,s,t.toRad()),$t(s,s,e.toRad()),Ht(s,s,r.toRad()),s}class fe{constructor(){c(this,"translation");c(this,"rotation");c(this,"scale");this.translation=P(),this.rotation=P(),this.scale=P(),Ft(this.scale,1,1,1)}matrix(t){const r=Array.from(this.rotation).map(q.deg),s=ue(r[0],r[1],r[2]);Ot(t,s,this.translation,this.scale)}}class tr{constructor(t,r){c(this,"parent");c(this,"name");c(this,"trs");c(this,"localMatrix");c(this,"globalMatrix");c(this,"take");c(this,"enabled");c(this,"components");this.parent=t,this.name=r,this.trs=new fe,this.localMatrix=C(),this.globalMatrix=C(),this.take=0,this.enabled=!0,this.components=new Set}preUpdate(t,r){var s;if(this.enabled)for(const n of this.components)(s=n.preUpdate)==null||s.call(n,this,t,r)}update(t){this.take!==t&&(this.trs.matrix(this.localMatrix),this.parent?(this.parent.update(t),lt(this.globalMatrix,this.parent.globalMatrix,this.localMatrix)):Rt(this.globalMatrix,this.localMatrix),this.take=t)}postUpdate(){var t;if(this.enabled)for(const r of this.components)(t=r.postUpdate)==null||t.call(r,this)}addComponent(t){this.components.add(t)}removeComponent(t){return this.components.delete(t)}get position(){return Et(P(),P(),this.globalMatrix)}get forward(){const t=L(0,0,-1),r=xt(mt(),this.globalMatrix);return zt(P(),t,r)}}class er{constructor(t,r,s){c(this,"fovy");c(this,"near");c(this,"far");this.fovy=t,this.near=r,this.far=s}matrix(t,r){return Pt(t,this.fovy.toRad(),r,this.near,this.far)}}class me{constructor(t,r,s,n){c(this,"view");c(this,"proj");c(this,"position");c(this,"inverseView");c(this,"inverseProj");s||(s=C(),t&&J(s,t)),n||(n=C(),r&&J(n,r));const i=Et(P(),L(0,0,0),s);this.view=t??C(),this.proj=r??C(),this.position=i,this.inverseView=s,this.inverseProj=n}get inverseViewProj(){return Ut(C(),this.inverseView,this.inverseProj)}}class rr{constructor(t,r,s){c(this,"node");c(this,"order");c(this,"normalizedViewportRect");c(this,"cullMask");c(this,"projection");this.node=t,this.order=r,this.projection=s,this.normalizedViewportRect=new z(0,0,1,1),this.cullMask=2147483647}update(t){this.node.update(t)}viewport(t,r){const s=new z(0,0,t,r);return this.normalizedViewportRect.validate().denormalize(s.w,s.h).clip(s)}prepare(t){Number.isFinite(t)||(t=1);const r=C();J(r,this.node.globalMatrix);const s=C();return this.projection.matrix(s,t),new me(r,s,this.node.globalMatrix)}}class pt{}class le extends pt{constructor(r){super();c(this,"typeTag");this.typeTag=r}check(r,s){r===void 0||x(r,this.typeTag,s)}}function E(e){return new le(e)}class Mt{constructor(t){c(this,"parent");this.parent=t}toString(){return(this.parent?this.parent.toString():"")+this.toStringSelf()}}class de extends Mt{constructor(r,s){super(s);c(this,"name");this.name=r}toStringSelf(){return"."+this.name}}class Ee extends Mt{constructor(r,s){super(s);c(this,"index");this.index=r}toStringSelf(){return"["+this.index+"]"}}function x(e,t,r){function s(){return r?r.toString()+": ":""}if(t instanceof pt)t.check(e,r);else if(typeof t=="string")switch(t){case"number":case"boolean":case"string":if(typeof e!==t)throw new Error(`${s()}${e} is not a ${t}`);break;default:throw new Error(`unsupported type tag: ${t}`)}else if(Array.isArray(t)){if(!Array.isArray(e))throw new Error(`${s()}${e} is not an array`);if(t.length===1)for(let n=0;n<e.length;++n)x(e[n],t[0],new Ee(n,r));else if(t.length>1)throw new Error("tuple is not supported")}else if(t&&typeof t=="object"){if(!e||typeof e!="object")throw new Error(`${s()}${e} is not an object`);for(const n in t)x(e[n],t[n],new de(n,r))}}const Ae=34962,be=34963,_e=5120,we=5121,Te=5122,ve=5123,pe=5125,Me=5126;function ye(e){try{if(x(e,{asset:{version:"string",copyright:E("string"),generator:E("string"),minVersion:E("string")},extensionsUsed:E(["string"]),extensionsRequired:E(["string"]),scene:E("number")}),e.accessors&&x(e.accessors,[{componentType:"number",count:"number",type:"string",bufferView:E("number"),byteOffset:E("number"),normalized:E("boolean"),max:E(["number"]),min:E(["number"]),sparse:E({}),name:E("string"),extensions:E({})}]),e.animations&&x(e.animations,[{channels:[{sampler:"number",target:{node:E("number"),path:"string",extensions:E({})},extensions:E({})}],samplers:[{input:"number",interpolation:E("string"),output:"number",extensions:E({})}],name:E("string"),extensions:E({})}]),e.buffers&&x(e.buffers,[{uri:E("string"),byteLength:"number",name:E("string"),extensions:E({})}]),e.bufferViews&&x(e.bufferViews,[{buffer:"number",byteOffset:E("number"),byteLength:"number",byteStride:E("number"),target:E("number"),name:E("string"),extensions:E({})}]),e.cameras&&x(e.cameras,[{orthographic:E({xmag:"number",ymag:"number",zfar:"number",znear:"number",extensions:E({})}),perspective:E({aspectRatio:E("number"),yfov:"number",zfar:E("number"),znear:"number",extensions:E({})}),type:"string",name:E("string"),extensions:E({})}]),e.meshes){x(e.meshes,[{primitives:[{attributes:{},indices:E("number"),material:E("number"),mode:E("number"),targets:E([{}]),extensions:E({})}],weights:E(["number"]),name:E("string"),extensions:E({})}]);for(const t of e.meshes)for(const r of t.primitives)if(!Object.values(r.attributes).every(s=>typeof s=="number"))throw new Error("mesh.primitive.attributes must have only number values")}if(e.nodes){x(e.nodes,[{camera:E("number"),children:E(["number"]),skin:E("number"),matrix:E(["number"]),mesh:E("number"),rotation:E(["number"]),scale:E(["number"]),translation:E(["number"]),weights:E(["number"]),name:E("string"),extensions:E({})}]);for(const t of e.nodes){if(t.matrix&&t.matrix.length!=16)throw new Error("node.matrix must have 16 elements");if(t.rotation&&t.rotation.length!=4)throw new Error("node.rotation must have 4 elements");if(t.scale&&t.scale.length!=3)throw new Error("node.scale must have 3 elements");if(t.translation&&t.translation.length!=3)throw new Error("node.translation must have 3 elements")}}return e.scenes&&x(e.scenes,[{node:E(["number"]),name:E("string"),extensions:E({})}]),e}catch(t){const r="Inavild glTF file: ";throw t instanceof Error?(t.message=r+t.message,t):new Error("Invalid glTF file: "+String(t))}}function Se(e){return Ne(e)*e.count}function Ne(e){const[t,r]=yt(e.type);return xe(t*Ie(e.componentType),4)*r}function Ie(e){switch(e){case _e:return 1;case we:return 1;case Te:return 2;case ve:return 2;case pe:return 4;case Me:return 4;default:throw new Error("Invalid component type code: "+e)}}function sr(e){const[t,r]=yt(e);return t*r}function xe(e,t){const r=e+(t-1),s=r%t;return r-s}function yt(e){switch(e){case"SCALAR":return[1,1];case"VEC2":return[2,1];case"VEC3":return[3,1];case"VEC4":return[4,1];case"MAT2":return[2,2];case"MAT3":return[3,3];case"MAT4":return[4,4];default:throw new Error("Invalid accessor type: "+e)}}function nr(e){const t=L(e[12],e[13],e[14]),r=[L(e[0],e[1],e[2]),L(e[4],e[5],e[6]),L(e[8],e[9],e[10])],s=L(H(r[0]),H(r[1]),H(r[2])),n=Y(P(),r[0],r[1]);dt(n,r[2])<0&&(s[2]=-s[2]);for(let o=0;o<3;++o)It(s[o],0)||Vt(r[o],r[o],1/s[o]);const a=At(X(),Lt(r[0][0],r[0][1],r[0][2],r[1][0],r[1][1],r[1][2],r[2][0],r[2][1],r[2][2]));return{translation:[t[0],t[1],t[2]],rotation:[a[0],a[1],a[2],a[3]],scale:[s[0],s[1],s[2]]}}function ir(e,t){if(t.bufferView!==void 0)return e.bufferViews[t.bufferView].byteStride}function Le(e){return async function(t){if(!t.uri)throw new Error("Can't fetch buffer data. URI not found");const r=new URL(t.uri,e),s=await fetch(r);if(!s.ok)throw new Error("failed to fetch data from: "+t.uri);return s.arrayBuffer()}}async function Re(e,t,r){var m;const s=(e.buffers||[]).map(t),i=(await Promise.all(s)).map((f,l)=>{const u=e.buffers[l];if(f.byteLength<u.byteLength)throw new Error(`fetched data is smaller(${f.byteLength}) than expected(${u.byteLength})`);return{...u,data:f}});console.assert(i.length===(((m=e.buffers)==null?void 0:m.length)||0));const a=(e.bufferViews||[]).map(f=>({...f})),o=(e.accessors||[]).map(f=>({...f,bufferView:f.bufferView??-1}));for(const f of o)if(f.bufferView===-1){const l=Se(f),u=new ArrayBuffer(l),d={byteLength:l,data:u};r&&r(f,u);const _={buffer:i.length,byteLength:l};f.bufferView=a.length,i.push(d),a.push(_)}for(const f of e.meshes||[])for(const l of f.primitives){for(const u of Object.values(l.attributes)){const d=o[u];a[d.bufferView].target=Ae}if(l.indices!=null){const u=o[l.indices];a[u.bufferView].target=be}}return{...e,buffers:i,bufferViews:a,accessors:o}}class ht extends Error{constructor(t){super(t)}}class ar{constructor(){c(this,"ticket");this.ticket={}}dispose(t){this.ticket.errorMessage=t,this.ticket={}}checkTicket(t){if(t!==this.ticket)throw new ht(t.errorMessage)}loadImage(t){return new Promise((r,s)=>{const n=this.ticket,i=new Image;i.onerror=s,i.onload=()=>{n!==this.ticket?s(new ht(n.errorMessage)):r(i)},i.src=t})}async loadImageBitmap(t,r){const s=this.ticket,n=await this.loadImage(t),i=await createImageBitmap(n,r);return this.checkTicket(s),i}async loadImageBitmapCube(t,r){const s=this.ticket,n=await Promise.all(t.map(i=>this.loadImageBitmap(i,r)));return this.checkTicket(s),n}async loadGltf(t){const r=this.ticket,s=await fetch(t);if(!s.ok)throw new Error("failed to fetch: "+t);const n=await s.text();this.checkTicket(r);const i=JSON.parse(n),a=await Re(ye(i),Le(t));return this.checkTicket(r),a}}const B=4,Oe=5123,$=5125,I=5126;class De{constructor(t,r){c(this,"min");c(this,"max");this.min=t,this.max=r}normalize(t){const r=st(W(),this.max,this.min),s=st(W(),t,this.min);return qt(W(),s,r)}}class or{static createSphere(t,r,s,n){s=Math.max(3,s),n=Math.max(2,n);const i=Math.PI,a=(n+1)*(s+1),o=[],h=[],m=[];for(let l=0;l<=n;++l)for(let u=0;u<=s;++u){const d=u/s*2*i,_=-i/2+l/n*i,A=Math.cos(_),b=Math.sin(_),p=Math.cos(d),S=Math.sin(d),T=A*p,w=b,v=-A*S;h.push(T,w,v),o.push(T*r,w*r,v*r),m.push(u/s,l/n)}const f=[];for(let l=0;l<n;++l)for(let u=0;u<s;++u){const d=l*(s+1)+u,_=d+1,A=d+s+1,b=A+1;l!==0&&f.push(d,_,A),l!=n-1&&f.push(A,_,b)}return{name:t,attributes:{POSITION:{buffer:new Float32Array(o),size:3,type:I,count:a},TEXCOORD_0:{buffer:new Float32Array(m),size:2,type:I,count:a},NORMAL:{buffer:new Float32Array(h),size:3,type:I,count:a}},indices:{buffer:new Uint32Array(f),type:$,count:f.length},drawMode:B}}static createCube(t,r,s,n){n=n??[0,0,0];const i=[[-.5,.5,-.5],[-.5,.5,.5],[.5,.5,.5],[.5,.5,-.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,-.5,.5],[-.5,-.5,.5],[-.5,.5,.5],[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[.5,.5,-.5],[.5,-.5,-.5],[-.5,-.5,-.5],[-.5,.5,-.5],[.5,.5,.5],[.5,-.5,.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5],[-.5,-.5,-.5],[-.5,-.5,.5],[-.5,.5,.5]],a=[[0,0],[0,1],[1,1],[1,0],[0,0],[1,0],[1,1],[0,1],[0,1],[0,0],[1,0],[1,1],[1,1],[1,0],[0,0],[0,1],[1,1],[0,1],[0,0],[1,0],[1,0],[0,0],[0,1],[1,1]];let o=[[0,1,0],[0,1,0],[0,1,0],[0,1,0],[0,-1,0],[0,-1,0],[0,-1,0],[0,-1,0],[0,0,1],[0,0,1],[0,0,1],[0,0,1],[0,0,-1],[0,0,-1],[0,0,-1],[0,0,-1],[1,0,0],[1,0,0],[1,0,0],[1,0,0],[-1,0,0],[-1,0,0],[-1,0,0],[-1,0,0]],h=[[1,0,0,-1],[1,0,0,-1],[1,0,0,-1],[1,0,0,-1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,-1],[1,0,0,-1],[1,0,0,-1],[1,0,0,-1],[0,1,0,1],[0,1,0,1],[0,1,0,1],[0,1,0,1],[0,1,0,-1],[0,1,0,-1],[0,1,0,-1],[0,1,0,-1]];const m=[0,1,2,2,3,0,4,5,6,6,7,4,8,9,10,10,11,8,12,13,14,14,15,12,16,17,18,18,19,16,20,21,22,22,23,20];r&&(m.reverse(),o=o.map(u=>u.map(d=>-1*d)),h=h.map(u=>[u[0],u[1],u[2],-u[3]]));function f(u,d){return[u[0]*d[0],u[1]*d[1],u[2]*d[2]]}function l(u,d){return[u[0]+d[0],u[1]+d[1],u[2]+d[2]]}return{name:t,attributes:{POSITION:{buffer:new Float32Array(i.map(u=>l(n,f(u,s))).flat()),size:3,type:I,count:24},TEXCOORD_0:{buffer:new Float32Array(a.flat()),size:2,type:I,count:24},NORMAL:{buffer:new Float32Array(o.flat()),size:3,type:I,count:24}},indices:{buffer:new Uint32Array(m),type:$,count:36},drawMode:B}}static createQuad(t){const r=[-1,-1,1,-1,1,1,-1,1],s=r.map(a=>a*.5+.5),n=[0,0,1,0,0,1,0,0,1,0,0,1],i=[0,1,2,2,3,0];return{name:t,attributes:{POSITION:{buffer:new Float32Array(r),size:2,type:I,count:4},TEXCOORD_0:{buffer:new Float32Array(s),size:2,type:I,count:4},NORMAL:{buffer:new Float32Array(n),size:3,type:I,count:4}},indices:{buffer:new Uint16Array(i),type:Oe,count:6},drawMode:B}}static createBackdrop(t){const r=[-1,-1,1,1,-1,1,1,1,1,-1,1,1],s=[0,1,2,2,3,0];return{name:t,attributes:{POSITION:{buffer:new Float32Array(r),size:3,type:I,count:4}},indices:{buffer:new Uint32Array(s),type:$,count:6},drawMode:B}}static createPlane(t,r,s,n){if(n<1)throw new Error(`slices should be greater than or equal to 1, but ${n}`);n=Math.floor(n);const i=L(-r/2,-s/2,0),a=L(r/2,s/2,0),o=r/n,h=s/n,m=rt(i),f=[],l=[],u=new De(Q(i[0],i[1]),Q(a[0],a[1]));for(let b=0;b<n+1;++b){m[0]=i[0];for(let p=0;p<n+1;++p)f.push(rt(m)),l.push(u.normalize(Q(m[0],m[1]))),m[0]+=o;m[1]+=h}const d=L(0,0,1),_=Array(f.length).fill(d),A=[];for(let b=0;b<n;++b)for(let p=0;p<n;++p){let S=(n+1)*b+p,T=S+1,w=S+(n+1),v=w+1;A.push(S),A.push(T),A.push(w),A.push(w),A.push(T),A.push(v)}return{name:t,attributes:{POSITION:{buffer:new Float32Array(f.map(b=>Array.from(b)).flat()),size:3,type:I,count:f.length},TEXCOORD_0:{buffer:new Float32Array(l.map(b=>Array.from(b)).flat()),size:2,type:I,count:f.length},NORMAL:{buffer:new Float32Array(_.map(b=>Array.from(b)).flat()),size:3,type:I,count:f.length}},indices:{buffer:new Uint32Array(A),type:$,count:A.length},drawMode:B}}}function Pe(e){return e*e}function Z(e,t){return e.map((r,s)=>r-t[s])}function Ue(e){return Math.sqrt(ge(e))}function ge(e){let t=0;for(let r=0;r<e.length;++r)t+=Pe(e[r]);return t}class cr{constructor(t,r){c(this,"clickPos");c(this,"currentPos");c(this,"button");c(this,"trails");c(this,"dragging");c(this,"count");c(this,"threshold");c(this,"onDrag");this.trails=0,this.dragging=!1,this.count=-1,this.threshold=r??2,this.onDrag=t}mouseDown(t){this.clickPos===void 0&&(this.currentPos=this.clickPos=[t.clientX,t.clientY],this.button=t.button)}mouseUp(t){this.clickPos===void 0||this.button!==t.button||(this.onDrag({button:t.button,startPos:this.clickPos,currentPos:this.currentPos,delta:[0,0],done:!0,count:this.count+1}),delete this.clickPos,delete this.currentPos,delete this.button,this.trails=0,this.dragging=!1)}mouseMove(t){if(this.clickPos===void 0)return;const r=this.currentPos;this.currentPos=[t.clientX,t.clientY];const s=Z(this.currentPos,r);this.trails+=Ue(s),this.dragging?(this.count++,this.onDrag({button:t.button,startPos:this.clickPos,currentPos:this.currentPos,delta:s,done:!1,count:this.count})):this.trails>this.threshold&&(this.dragging=!0,this.count=0,this.onDrag({button:t.button,startPos:this.clickPos,currentPos:this.currentPos,delta:Z(this.currentPos,this.clickPos),done:!1,count:0}))}}function ut(e,t){const r=[];for(let s=0;s<e.length;++s){const n=e[s];if(n.target!==t)continue;const i=[n.clientX,n.clientY];r.push({id:n.identifier,startPos:i,currentPos:i,delta:[0,0]})}return r}function Fe(e){for(let t=1;t<e.length;++t)if(e[t].target!==e[0].target)return!1;return!0}class hr{constructor(t){c(this,"target");c(this,"callback");c(this,"touchDrags");this.callback=t,this.touchDrags=[]}touchStart(t){!this.target&&Fe(t.touches)&&(this.target=t.touches[0].target),this.touchDrags=ut(t.touches,this.target),this.target&&t.preventDefault()}touchEnd(t){this.target&&(t.preventDefault(),this.touchDrags=ut(t.touches,this.target),this.touchDrags.length||delete this.target)}touchMove(t){if(this.target){t.preventDefault();for(let r=0;r<t.touches.length;++r){const s=t.touches[r];if(s.target!==this.target)continue;const n=this.touchDrags.find(h=>h.id==s.identifier);if(!n)throw new Error("Logic Error: touchMove");const i=n.currentPos,a=[s.clientX,s.clientY],o=Z(a,i);n.currentPos=a,n.delta=o}this.callback({touchDrags:this.touchDrags})}}}function ur(e,t){e.width=e.clientWidth,e.height=e.clientHeight;for(let r=window.devicePixelRatio;r>1;r/=2){const s=Math.round(e.clientWidth*r),n=Math.round(e.clientHeight*r);if(s<=1024){e.width=s,e.height=n;break}}}function fr(e){const t=e.getContext("webgl2");if(!t)throw new Error("This browser does not support WebGL2");let r=t;for(const s of["EXT_color_buffer_float"])if(!r.getExtension(s))throw new Error(`This browser does not support extension: ${s}`);return r}class mr{constructor(){c(this,"scrollDelta");c(this,"dragDelta");this.scrollDelta=0,this.dragDelta=[0,0]}reset(){this.scrollDelta=0,this.dragDelta[0]=0,this.dragDelta[1]=0}scroll(t){this.scrollDelta+=t}drag(t,r){this.dragDelta[0]+=t,this.dragDelta[1]+=r}}var lr=`#version 300 es

in vec2 POSITION;

out vec2 v_texCoord;

void main()
{
    v_texCoord = POSITION * 0.5 + 0.5;
    gl_Position = vec4(POSITION, 0, 1);
}`;export{ar as A,nt as B,rr as C,He as D,Yt as E,je as F,Qe as G,X as H,mr as I,$t as J,Be as K,ze as L,cr as M,tr as N,Q as O,Xe as P,Ce as Q,$e as R,Tt as S,hr as T,W as U,Ye as V,Y as W,P as X,Ct as Y,gt as Z,kt as _,Je as a,qe as b,Ke as c,Ze as d,L as e,lr as f,ir as g,nr as h,fr as i,ke as j,C as k,k as l,or as m,sr as n,Ge as o,mt as p,Rt as q,ur as r,Ut as s,er as t,te as u,q as v,he as w,Z as x,Ue as y,We as z};
