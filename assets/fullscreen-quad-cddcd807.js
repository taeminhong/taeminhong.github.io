var Ne=Object.defineProperty;var Re=(e,t,r)=>t in e?Ne(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var c=(e,t,r)=>(Re(e,typeof t!="symbol"?t+"":t,r),r);var me=1e-6,P=typeof Float32Array<"u"?Float32Array:Array;function Le(e,t){return Math.abs(e-t)<=me*Math.max(1,Math.abs(e),Math.abs(t))}Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});function ut(){var e=new P(9);return P!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function Ue(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e}function De(e,t,r,n,s,i,a,o,h){var u=new P(9);return u[0]=e,u[1]=t,u[2]=r,u[3]=n,u[4]=s,u[5]=i,u[6]=a,u[7]=o,u[8]=h,u}function vn(e,t,r){var n=t[0],s=t[1],i=t[2],a=t[3],o=t[4],h=t[5],u=t[6],l=t[7],d=t[8],m=r[0],g=r[1];return e[0]=n,e[1]=s,e[2]=i,e[3]=a,e[4]=o,e[5]=h,e[6]=m*n+g*a+u,e[7]=m*s+g*o+l,e[8]=m*i+g*h+d,e}function An(e,t,r){var n=r[0],s=r[1];return e[0]=n*t[0],e[1]=n*t[1],e[2]=n*t[2],e[3]=s*t[3],e[4]=s*t[4],e[5]=s*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function En(e,t){var r=t[0],n=t[1],s=t[2],i=t[3],a=r+r,o=n+n,h=s+s,u=r*a,l=n*a,d=n*o,m=s*a,g=s*o,A=s*h,y=i*a,v=i*o,T=i*h;return e[0]=1-d-A,e[3]=l-T,e[6]=m+v,e[1]=l+T,e[4]=1-u-A,e[7]=g-y,e[2]=m-v,e[5]=g+y,e[8]=1-u-d,e}function Oe(e,t){var r=t[0],n=t[1],s=t[2],i=t[3],a=t[4],o=t[5],h=t[6],u=t[7],l=t[8],d=t[9],m=t[10],g=t[11],A=t[12],y=t[13],v=t[14],T=t[15],M=r*o-n*a,E=r*h-s*a,f=r*u-i*a,w=n*h-s*o,b=n*u-i*o,_=s*u-i*h,S=l*y-d*A,D=l*v-m*A,U=l*T-g*A,O=d*v-m*y,V=d*T-g*y,F=m*T-g*v,x=M*F-E*V+f*O+w*U-b*D+_*S;return x?(x=1/x,e[0]=(o*F-h*V+u*O)*x,e[1]=(h*U-a*F-u*D)*x,e[2]=(a*V-o*U+u*S)*x,e[3]=(s*V-n*F-i*O)*x,e[4]=(r*F-s*U+i*D)*x,e[5]=(n*U-r*V-i*S)*x,e[6]=(y*_-v*b+T*w)*x,e[7]=(v*f-A*_-T*E)*x,e[8]=(A*b-y*f+T*M)*x,e):null}function L(){var e=new P(16);return P!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function ht(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function nt(e,t){var r=t[0],n=t[1],s=t[2],i=t[3],a=t[4],o=t[5],h=t[6],u=t[7],l=t[8],d=t[9],m=t[10],g=t[11],A=t[12],y=t[13],v=t[14],T=t[15],M=r*o-n*a,E=r*h-s*a,f=r*u-i*a,w=n*h-s*o,b=n*u-i*o,_=s*u-i*h,S=l*y-d*A,D=l*v-m*A,U=l*T-g*A,O=d*v-m*y,V=d*T-g*y,F=m*T-g*v,x=M*F-E*V+f*O+w*U-b*D+_*S;return x?(x=1/x,e[0]=(o*F-h*V+u*O)*x,e[1]=(s*V-n*F-i*O)*x,e[2]=(y*_-v*b+T*w)*x,e[3]=(m*b-d*_-g*w)*x,e[4]=(h*U-a*F-u*D)*x,e[5]=(r*F-s*U+i*D)*x,e[6]=(v*f-A*_-T*E)*x,e[7]=(l*_-m*f+g*E)*x,e[8]=(a*V-o*U+u*S)*x,e[9]=(n*U-r*V-i*S)*x,e[10]=(A*b-y*f+T*M)*x,e[11]=(d*f-l*b-g*M)*x,e[12]=(o*D-a*O-h*S)*x,e[13]=(r*O-n*D+s*S)*x,e[14]=(y*E-A*w-v*M)*x,e[15]=(l*w-d*E+m*M)*x,e):null}function de(e,t,r){var n=t[0],s=t[1],i=t[2],a=t[3],o=t[4],h=t[5],u=t[6],l=t[7],d=t[8],m=t[9],g=t[10],A=t[11],y=t[12],v=t[13],T=t[14],M=t[15],E=r[0],f=r[1],w=r[2],b=r[3];return e[0]=E*n+f*o+w*d+b*y,e[1]=E*s+f*h+w*m+b*v,e[2]=E*i+f*u+w*g+b*T,e[3]=E*a+f*l+w*A+b*M,E=r[4],f=r[5],w=r[6],b=r[7],e[4]=E*n+f*o+w*d+b*y,e[5]=E*s+f*h+w*m+b*v,e[6]=E*i+f*u+w*g+b*T,e[7]=E*a+f*l+w*A+b*M,E=r[8],f=r[9],w=r[10],b=r[11],e[8]=E*n+f*o+w*d+b*y,e[9]=E*s+f*h+w*m+b*v,e[10]=E*i+f*u+w*g+b*T,e[11]=E*a+f*l+w*A+b*M,E=r[12],f=r[13],w=r[14],b=r[15],e[12]=E*n+f*o+w*d+b*y,e[13]=E*s+f*h+w*m+b*v,e[14]=E*i+f*u+w*g+b*T,e[15]=E*a+f*l+w*A+b*M,e}function Ve(e,t,r,n){var s=t[0],i=t[1],a=t[2],o=t[3],h=s+s,u=i+i,l=a+a,d=s*h,m=s*u,g=s*l,A=i*u,y=i*l,v=a*l,T=o*h,M=o*u,E=o*l,f=n[0],w=n[1],b=n[2];return e[0]=(1-(A+v))*f,e[1]=(m+E)*f,e[2]=(g-M)*f,e[3]=0,e[4]=(m-E)*w,e[5]=(1-(d+v))*w,e[6]=(y+T)*w,e[7]=0,e[8]=(g+M)*b,e[9]=(y-T)*b,e[10]=(1-(d+A))*b,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function Fe(e,t,r,n,s){var i=1/Math.tan(t/2),a;return e[0]=i/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,s!=null&&s!==1/0?(a=1/(n-s),e[10]=(s+n)*a,e[14]=2*s*n*a):(e[10]=-1,e[14]=-2*n),e}var Ce=Fe,pe=de;function z(){var e=new P(3);return P!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function Z(e){var t=new P(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function ze(e){var t=e[0],r=e[1],n=e[2];return Math.hypot(t,r,n)}function R(e,t,r){var n=new P(3);return n[0]=e,n[1]=t,n[2]=r,n}function Zt(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function te(e,t,r,n){return e[0]=t,e[1]=r,e[2]=n,e}function $e(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e}function ee(e,t){var r=t[0]-e[0],n=t[1]-e[1],s=t[2]-e[2];return Math.hypot(r,n,s)}function ke(e,t){var r=t[0],n=t[1],s=t[2],i=r*r+n*n+s*s;return i>0&&(i=1/Math.sqrt(i)),e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e}function be(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function Q(e,t,r){var n=t[0],s=t[1],i=t[2],a=r[0],o=r[1],h=r[2];return e[0]=s*h-i*o,e[1]=i*a-n*h,e[2]=n*o-s*a,e}function ge(e,t,r){var n=t[0],s=t[1],i=t[2],a=r[3]*n+r[7]*s+r[11]*i+r[15];return a=a||1,e[0]=(r[0]*n+r[4]*s+r[8]*i+r[12])/a,e[1]=(r[1]*n+r[5]*s+r[9]*i+r[13])/a,e[2]=(r[2]*n+r[6]*s+r[10]*i+r[14])/a,e}function Be(e,t,r){var n=t[0],s=t[1],i=t[2];return e[0]=n*r[0]+s*r[3]+i*r[6],e[1]=n*r[1]+s*r[4]+i*r[7],e[2]=n*r[2]+s*r[5]+i*r[8],e}var J=ze;(function(){var e=z();return function(t,r,n,s,i,a){var o,h;for(r||(r=3),n||(n=0),s?h=Math.min(s*r+n,t.length):h=t.length,o=n;o<h;o+=r)e[0]=t[o],e[1]=t[o+1],e[2]=t[o+2],i(e,e,a),t[o]=e[0],t[o+1]=e[1],t[o+2]=e[2];return t}})();function Ge(){var e=new P(4);return P!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function Xe(e){var t=new P(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function Ye(e,t){var r=t[0],n=t[1],s=t[2],i=t[3],a=r*r+n*n+s*s+i*i;return a>0&&(a=1/Math.sqrt(a)),e[0]=r*a,e[1]=n*a,e[2]=s*a,e[3]=i*a,e}(function(){var e=Ge();return function(t,r,n,s,i,a){var o,h;for(r||(r=4),n||(n=0),s?h=Math.min(s*r+n,t.length):h=t.length,o=n;o<h;o+=r)e[0]=t[o],e[1]=t[o+1],e[2]=t[o+2],e[3]=t[o+3],i(e,e,a),t[o]=e[0],t[o+1]=e[1],t[o+2]=e[2],t[o+3]=e[3];return t}})();function B(){var e=new P(4);return P!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function He(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function We(e,t,r){r=r*.5;var n=Math.sin(r);return e[0]=n*t[0],e[1]=n*t[1],e[2]=n*t[2],e[3]=Math.cos(r),e}function je(e,t,r){r*=.5;var n=t[0],s=t[1],i=t[2],a=t[3],o=Math.sin(r),h=Math.cos(r);return e[0]=n*h+a*o,e[1]=s*h+i*o,e[2]=i*h-s*o,e[3]=a*h-n*o,e}function qe(e,t,r){r*=.5;var n=t[0],s=t[1],i=t[2],a=t[3],o=Math.sin(r),h=Math.cos(r);return e[0]=n*h-i*o,e[1]=s*h+a*o,e[2]=i*h+n*o,e[3]=a*h-s*o,e}function Qe(e,t,r){r*=.5;var n=t[0],s=t[1],i=t[2],a=t[3],o=Math.sin(r),h=Math.cos(r);return e[0]=n*h+s*o,e[1]=s*h-n*o,e[2]=i*h+a*o,e[3]=a*h-i*o,e}function j(e,t,r,n){var s=t[0],i=t[1],a=t[2],o=t[3],h=r[0],u=r[1],l=r[2],d=r[3],m,g,A,y,v;return g=s*h+i*u+a*l+o*d,g<0&&(g=-g,h=-h,u=-u,l=-l,d=-d),1-g>me?(m=Math.acos(g),A=Math.sin(m),y=Math.sin((1-n)*m)/A,v=Math.sin(n*m)/A):(y=1-n,v=n),e[0]=y*s+v*h,e[1]=y*i+v*u,e[2]=y*a+v*l,e[3]=y*o+v*d,e}function we(e,t){var r=t[0]+t[4]+t[8],n;if(r>0)n=Math.sqrt(r+1),e[3]=.5*n,n=.5/n,e[0]=(t[5]-t[7])*n,e[1]=(t[6]-t[2])*n,e[2]=(t[1]-t[3])*n;else{var s=0;t[4]>t[0]&&(s=1),t[8]>t[s*3+s]&&(s=2);var i=(s+1)%3,a=(s+2)%3;n=Math.sqrt(t[s*3+s]-t[i*3+i]-t[a*3+a]+1),e[s]=.5*n,n=.5/n,e[3]=(t[i*3+a]-t[a*3+i])*n,e[i]=(t[i*3+s]+t[s*3+i])*n,e[a]=(t[a*3+s]+t[s*3+a])*n}return e}var re=Xe,ye=Ye;(function(){var e=z(),t=R(1,0,0),r=R(0,1,0);return function(n,s,i){var a=be(s,i);return a<-.999999?(Q(e,t,s),J(e)<1e-6&&Q(e,r,s),ke(e,e),We(n,e,Math.PI),n):a>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(Q(e,s,i),n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=1+a,ye(n,n))}})();(function(){var e=B(),t=B();return function(r,n,s,i,a,o){return j(e,n,a,o),j(t,s,i,o),j(r,e,t,2*o*(1-o)),r}})();(function(){var e=ut();return function(t,r,n,s){return e[0]=n[0],e[3]=n[1],e[6]=n[2],e[1]=s[0],e[4]=s[1],e[7]=s[2],e[2]=-r[0],e[5]=-r[1],e[8]=-r[2],ye(t,we(t,e))}})();function K(){var e=new P(2);return P!=Float32Array&&(e[0]=0,e[1]=0),e}function et(e,t){var r=new P(2);return r[0]=e,r[1]=t,r}function Je(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e}function Ke(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e}function Tn(e,t,r){var n=t[0],s=t[1];return e[0]=r[0]*n+r[3]*s+r[6],e[1]=r[1]*n+r[4]*s+r[7],e}var ne=Je,Ze=Ke;(function(){var e=K();return function(t,r,n,s,i,a){var o,h;for(r||(r=2),n||(n=0),s?h=Math.min(s*r+n,t.length):h=t.length,o=n;o<h;o+=r)e[0]=t[o],e[1]=t[o+1],i(e,e,a),t[o]=e[0],t[o+1]=e[1];return t}})();const ft=35679,lt=35682,mt=35685,dt=35686,pt=35687,bt=35688,gt=35689,wt=35690,yt=36289,vt=36292,At=36293,Et=36294,Tt=36295,xt=36296,Mt=36298,_t=36299,St=36300,It=36303,Pt=36306,Nt=36307,Rt=36308,Lt=36311,tr=36182,X=4,er=0,rr=1280,nr=1281,sr=1282,ir=1285,Ut=5120,Dt=5121,Ot=5122,tt=5123,G=5124,C=5125,I=5126,ar=35632,or=35633,cr=3553,ur=34067,Vt=35664,Ft=35665,Ct=35666,zt=35667,$t=35668,kt=35669,Bt=35670,Gt=35671,Xt=35672,Yt=35673,Ht=35674,Wt=35675,jt=35676,qt=35678,Qt=35680,hr=36054,fr=36055,lr=36057,mr=36061,dr=1286,pr=37442;class br{constructor(t,r,n){c(this,"gl");c(this,"target");this.gl=t,this.target=r,t.bindBuffer(r,n)}unbind(){this.gl.bindBuffer(this.target,null)}data(t,r,n,s){n===void 0?this.gl.bufferData(this.target,t,r):this.gl.bufferData(this.target,t,r,n,s)}vertexAttribPointer(t,r,n,s,i,a){this.gl.vertexAttribPointer(t,r,n,s,i,a),this.gl.enableVertexAttribArray(t)}vertexAttribIPointer(t,r,n,s,i){this.gl.vertexAttribIPointer(t,r,n,s,i),this.gl.enableVertexAttribArray(t)}}class st{constructor(t,r){c(this,"buffer");c(this,"target");const n=t.createBuffer();this.buffer=n,this.target=r}bind(t){return new br(t,this.target,this.buffer)}}class gr{constructor(t,r){c(this,"gl");t.bindVertexArray(r),this.gl=t}unbind(){this.gl.bindVertexArray(null)}}class wr{constructor(t){c(this,"vao");const r=t.createVertexArray();this.vao=r}bind(t){return new gr(t,this.vao)}}function Y(e,t){if(t instanceof Function)return t(e);if(typeof t!="boolean"||!t)throw e}class Jt extends Error{constructor(){super("Not implemented yet")}}function ve(e){switch(e){case G:case Bt:case I:return"scalar";case zt:case $t:case kt:case Gt:case Xt:case Yt:case Vt:case Ft:case Ct:return"vector";case Ht:case Wt:case jt:return"matrix";case qt:case Qt:return"sampler";case C:return"scalar";case Et:case Tt:case xt:return"vector";case mt:case dt:case pt:case bt:case gt:case wt:return"matrix";case ft:case lt:case yt:case vt:case At:case Mt:case _t:case St:case It:case Pt:case Nt:case Rt:case Lt:return"sampler";default:throw new Error(`invalid uniform type: ${e}`)}}function yr(e){switch(e){case G:return 1;case Bt:return 1;case I:return 1;case zt:return 2;case Gt:return 2;case Vt:return 2;case $t:return 3;case Xt:return 3;case Ft:return 3;case kt:return 4;case Yt:return 4;case Ct:return 4;case Ht:return 4;case Wt:return 9;case jt:return 16;case qt:return 1;case Qt:return 1;case C:return 1;case Et:return 2;case Tt:return 3;case xt:return 4;case mt:return 6;case dt:return 8;case pt:return 6;case bt:return 12;case gt:return 8;case wt:return 12;case ft:return 1;case lt:case yt:case vt:case At:case Mt:case _t:case St:case It:case Pt:case Nt:case Rt:case Lt:throw new Jt;default:throw new Error(`Invalid uniform type: ${e}`)}}class it{constructor(t){c(this,"name");c(this,"type");c(this,"size");c(this,"location");c(this,"category");c(this,"numElements");c(this,"values");this.name=t.name,this.type=t.type,this.location=t.location,this.size=t.size,this.numElements=yr(t.type),this.category=ve(t.type),this.values=Array(t.size*this.numElements),this.reset()}bind(t){switch(this.type){case t.FLOAT:return t.uniform1fv(this.location,this.values);case t.BOOL:return t.uniform1iv(this.location,this.values);case t.INT:return t.uniform1iv(this.location,this.values);case t.FLOAT_VEC2:return t.uniform2fv(this.location,this.values);case t.FLOAT_VEC3:return t.uniform3fv(this.location,this.values);case t.FLOAT_VEC4:return t.uniform4fv(this.location,this.values);case t.BOOL_VEC2:return t.uniform2iv(this.location,this.values);case t.INT_VEC2:return t.uniform2iv(this.location,this.values);case t.BOOL_VEC3:return t.uniform3iv(this.location,this.values);case t.INT_VEC3:return t.uniform3iv(this.location,this.values);case t.BOOL_VEC4:return t.uniform4iv(this.location,this.values);case t.INT_VEC4:return t.uniform4iv(this.location,this.values);case t.FLOAT_MAT2:return t.uniformMatrix2fv(this.location,!1,this.values);case t.FLOAT_MAT3:return t.uniformMatrix3fv(this.location,!1,this.values);case t.FLOAT_MAT4:return t.uniformMatrix4fv(this.location,!1,this.values);case t.SAMPLER_2D:return t.uniform1iv(this.location,this.values);case t.SAMPLER_CUBE:return t.uniform1iv(this.location,this.values);case t.UNSIGNED_INT:return t.uniform1uiv(this.location,this.values);case t.UNSIGNED_INT_VEC2:return t.uniform2uiv(this.location,this.values);case t.UNSIGNED_INT_VEC3:return t.uniform3uiv(this.location,this.values);case t.UNSIGNED_INT_VEC4:return t.uniform4uiv(this.location,this.values);case t.FLOAT_MAT2x3:case t.FLOAT_MAT2x4:case t.FLOAT_MAT3x2:case t.FLOAT_MAT3x4:case t.FLOAT_MAT4x2:case t.FLOAT_MAT4x3:case t.SAMPLER_3D:case t.SAMPLER_2D_SHADOW:case t.SAMPLER_2D_ARRAY:case t.SAMPLER_2D_ARRAY_SHADOW:case t.SAMPLER_CUBE_SHADOW:case t.INT_SAMPLER_2D:case t.INT_SAMPLER_3D:case t.INT_SAMPLER_CUBE:case t.INT_SAMPLER_2D_ARRAY:case t.UNSIGNED_INT_SAMPLER_2D:case t.UNSIGNED_INT_SAMPLER_3D:case t.UNSIGNED_INT_SAMPLER_CUBE:case t.UNSIGNED_INT_SAMPLER_2D_ARRAY:return}}set(t,r){switch(r=r||0,this.checkIndex(r),this.category){case"scalar":return this.setScalar(t,r);case"vector":return this.setVector(t,r);case"matrix":return this.setMatrix(t,r);case"sampler":return this.setScalar(t,r);default:throw new Jt}}reset(){if(this.values.fill(0),this.category==="vector"&&this.numElements===4)for(let t=0;t<this.size;++t)this.values[this.numElements*t+3]=1;else if(this.category==="matrix"&&this.numElements===16)for(let t=0;t<this.size;++t)this.values[this.numElements*t+15]=1}get(t){return t=t||0,this.checkIndex(t),this.numElements===1?this.values[t]:this.values.slice(this.numElements*t,this.numElements)}checkIndex(t){if(t<0)throw new RangeError(`${this.name}: negative index: ${t}`);if(t>=this.size)throw new RangeError(`${this.name}: index must be less than ${this.size}, but ${t}`)}setScalar(t,r){if(typeof t=="number"||typeof t=="boolean")this.values[r]=Number(t);else throw new Error(`${this.name}: invalid value: ${t}`)}setVector(t,r){let n;if(t instanceof Float32Array||t instanceof Int32Array||t instanceof Uint32Array)n=t;else if(Array.isArray(t))t.every(a=>typeof a=="number")?n=t:n=t.map(Number);else if(t&&typeof t=="object"&&Symbol.iterator in t)n=Array.from(t).map(Number);else throw new Error(`${this.name}: invalid value: ${t}`);if(n.length===0)throw new Error(`${this.name}: empty vector`);const s=[0,0,0,1];for(let a=0;a<Math.min(n.length,4);++a)s[a]=n[a];s.length=this.numElements;const i=r*this.numElements;for(let a=0;a<this.numElements;++a)this.values[i+a]=s[a]}setMatrix(t,r){let n;if(t instanceof Float32Array)n=t;else if(Array.isArray(t))t.every(i=>typeof i=="number")?n=t:n=t.map(Number);else if(t&&typeof t=="object"&&Symbol.iterator in t)n=Array.from(t).map(Number);else throw new Error(`${this.name}: invalid value: ${t}`);if(n.length!=this.numElements)throw new Error(`${this.name}: matrix size mismatch: ${this.numElements} expected, but ${n.length}`);const s=r*this.numElements;for(let i=0;i<n.length;++i)this.values[s+i]=n[i]}}class se{constructor(t,r,n){c(this,"textureTarget");c(this,"textures");c(this,"realUniform");if(ve(t.type)!=="sampler")throw new Error(`${t.name}: invalid uniform info`);const s=new it(t);for(let i=0;i<t.size;++i){const a=r.length;r.push(null),s.set(a,i)}this.realUniform=s,this.textures=r,this.textureTarget=n}set(t,r){if(t instanceof Ee){if(t.target!==this.textureTarget)throw new Error(`${this.realUniform.name}: invalid target: ${this.textureTarget} expected, but ${t.target}`);this.textures[this.realUniform.get(r)]=t}else if(t===null)this.textures[this.realUniform.get(r)]=null;else throw new Error(`${this.realUniform.name}: invalid value: ${t}`)}reset(){for(let t=0;t<this.size;++t)this.textures[this.realUniform.get(t)]=null}bind(t){for(let r=0;r<this.realUniform.size;++r){const n=this.realUniform.get(r);t.activeTexture(t.TEXTURE0+n);const s=this.textures[n];s?s.bind(t):t.bindTexture(this.textureTarget,null)}this.realUniform.bind(t)}get(t){return this.textures[this.realUniform.get(t)]}get size(){return this.realUniform.size}get category(){return this.realUniform.category}get name(){return this.realUniform.name}get type(){return this.realUniform.type}get numElements(){return this.realUniform.numElements}get location(){return this.realUniform.location}}class xn{constructor(t){c(this,"locators");this.locators=t}}function vr(e,t,r,n){if(n.some(i=>i.shader===null)||!n.some(i=>i.type===e.VERTEX_SHADER)||!n.some(i=>i.type===e.FRAGMENT_SHADER))return null;const s=e.createProgram();if(!s)return null;for(const i of n)e.attachShader(s,i.shader);for(const i of r.locators)e.bindAttribLocation(s,i.location,i.name);if(e.linkProgram(s),!e.isContextLost()&&!e.getProgramParameter(s,e.LINK_STATUS)){const i=e.getProgramInfoLog(s)??"Program link failed.",a=`${t}: ${i}
`,o=n.map(h=>h.getInfoLog(e)).filter(h=>!!h);throw e.deleteProgram(s),new Error(a+o.join(`

`))}return s}function ie(e){switch(e){case or:return"vertex";case ar:return"fragment";default:throw new Error("Unkonw shader type code: "+e)}}function Mn(e,t){return new Ae(e,e.VERTEX_SHADER,t)}function _n(e,t){return new Ae(e,e.FRAGMENT_SHADER,t)}class Ae{constructor(t,r,n){c(this,"shader");c(this,"type");c(this,"log");c(this,"source");ie(r);const s=t.createShader(r);s&&(t.shaderSource(s,n),t.compileShader(s)),this.shader=s,this.type=r,this.log=null,this.source=n}getInfoLog(t){if(this.shader&&this.source){const r=t.getShaderInfoLog(this.shader);if(r){const n=ie(this.type);this.log=`${n} shader
${r}${Ir(this.source)}`}delete this.source}return this.log}}class Sn{constructor(t,r,n,...s){c(this,"name");c(this,"vertexModel");c(this,"program");c(this,"attributes");c(this,"uniforms");const i=new Map,a=new Map,o=vr(t,r,n,s);if(o){const h=t.getProgramParameter(o,t.ACTIVE_ATTRIBUTES);for(let l=0;l<h;++l){const d=t.getActiveAttrib(o,l);if(d){const m=d.name,g=d.type,A=d.size,y=t.getAttribLocation(o,m),v=n.locators.find(T=>T.name===m);if((v==null?void 0:v.location)!==y)throw Error("program is not compatible with the given vertex model");a.set(m,{name:m,type:g,size:A,location:y,index:l})}}const u=t.getProgramParameter(o,t.ACTIVE_UNIFORMS);for(let l=0;l<u;++l){const d=t.getActiveUniform(o,l);if(d){const m=d.name,g=d.type,A=d.size,y=t.getUniformLocation(o,m);y&&i.set(m,{name:m,type:g,size:A,location:y,index:l})}}}this.program=o,this.uniforms=i,this.attributes=a,this.name=r,this.vertexModel=n}use(t){t.useProgram(this.program)}restore(t){t.useProgram(null)}getAttribLocation(t){const r=this.attributes.get(t);return r?r.location:-1}getUniformLocation(t){const r=this.uniforms.get(t);return r?r.location:null}getUniformInfos(){return Array.from(this.uniforms.values()).sort((t,r)=>t.index-r.index)}}function Ar(e,t,r){const n=e.bind(t);try{r(n)}finally{n.unbind()}}class Er{constructor(t,r,n){c(this,"gl");c(this,"target");this.gl=t,this.target=r,this.gl.bindTexture(this.target,n)}unbind(){this.gl.bindTexture(this.target,null)}generateMipmap(){return this.gl.generateMipmap(this.target),this}parameteri(t,r){return this.gl.texParameteri(this.target,t,r),this}}class Ee{constructor(t,r,n,s){c(this,"texture");c(this,"target");c(this,"levels");c(this,"internalFormat");if(n<=0)throw new RangeError(`Invalid number of levels: ${n}`);this.texture=t.createTexture(),this.target=r,this.internalFormat=s,this.levels=n}swap(t){if(this.constructor!==t.constructor)throw new Error("Can't swap objects of two distinct types");[this.texture,t.texture]=[t.texture,this.texture],[this.target,t.target]=[t.target,this.target],[this.levels,t.levels]=[t.levels,this.levels],[this.internalFormat,t.internalFormat]=[t.internalFormat,this.internalFormat]}}function Tr(e){let t=1,r=0;for(r=0;t<=e;++r)t*=2;return r}function ae(e,t){for(let r=0;r<t;++r)e=Math.floor(e/2);return Math.max(1,e)}class xr extends Er{constructor(t,r,n){super(t,r,n)}subImage2D(...t){return this.gl.texSubImage2D(...t),this}subImageCube(...t){if(this.target!==this.gl.TEXTURE_CUBE_MAP)throw new Error(`Invalid target for subImageCube: ${this.target}`);const r=[t.pop()].flat();for(let n=0;n<6;++n){const s=r[n%r.length];this.gl.texSubImage2D(this.gl.TEXTURE_CUBE_MAP_POSITIVE_X+n,...t,s)}return this}}class Mr extends Ee{constructor(r,n,s,i,a,o){super(r,n,s,i);c(this,"width");c(this,"height");r.bindTexture(this.target,this.texture),r.texStorage2D(this.target,s,i,a,o),r.bindTexture(this.target,null),this.width=a,this.height=o}swap(r){super.swap(r),[this.width,r.width]=[r.width,this.width],[this.height,r.height]=[r.height,this.height]}bind(r){return new xr(r,this.target,this.texture)}}class _r{constructor(t,r){c(this,"gl");c(this,"framebuffer");t.bindFramebuffer(r.target,r.framebuffer),this.gl=t,this.framebuffer=r}texture2D(t,r,n,s){if(this.gl.framebufferTexture2D(this.framebuffer.target,t,r,(n==null?void 0:n.texture)||null,s),n){const i=ae(n.width,s),a=ae(n.height,s);this.framebuffer.attachments.set(t,{size:{width:i,height:a}})}else this.framebuffer.attachments.delete(t);return this}checkStatus(t){return t(this.gl.checkFramebufferStatus(this.framebuffer.target)),this}drawBuffers(...t){return this.gl.drawBuffers(t),this}readPixels(...t){this.gl.readPixels(...t)}unbind(){this.gl.bindFramebuffer(this.framebuffer.target,null)}}class In{constructor(t,r){c(this,"framebuffer");c(this,"target");c(this,"attachments");this.framebuffer=t.createFramebuffer(),this.target=r,this.attachments=new Map}bind(t){return new _r(t,this)}get size(){const t={width:0,height:0};return this.attachments.size==0?t:Array.from(this.attachments.values()).map(n=>n.size).reduce((n,s)=>n.width===s.width&&n.height===s.height?n:t)}}function Sr(e){switch(e){case er:return"No error";case rr:return"Invalid enum";case nr:return"Invalid value";case sr:return"Invalid operation";case dr:return"Invalid framebuffer operation";case ir:return"Out of memory";case pr:return"Conext lost";case hr:return"Framebuffer incomplete attachment";case fr:return"Framebuffer incomplete missing attachment";case lr:return"Framebuffer incomplete dimensions";case mr:return"Framebuffer unsupported";case tr:return"Framebuffer incomplete multisample";default:return`Unknwon error: ${e}`}}function Te(e){switch(e){case Ut:return 1;case Dt:return 1;case Ot:return 2;case tt:return 2;case G:return 4;case C:return 4;case I:return 4;default:throw new Error("Unknown type")}}class Pn extends Error{constructor(t){super(Sr(t))}}function Ir(e,t){function r(i,a,o,h){return String(a+1).padStart(o," ")+h+i}const n=e.split(`
`),s=String(n.length).length;return n.map((i,a)=>r(i,a,s,": ")).join(`
`)}function Pr(e,t){switch(e.type){case G:case Bt:case I:case zt:case $t:case kt:case Gt:case Xt:case Yt:case Vt:case Ft:case Ct:case Ht:case Wt:case jt:return new it(e);case qt:return new se(e,t,cr);case Qt:return new se(e,t,ur);case C:case Et:case Tt:case xt:return new it(e);case mt:case dt:case pt:case bt:case gt:case wt:case ft:case lt:case yt:case vt:case At:case Mt:case _t:case St:case It:case Pt:case Nt:case Rt:case Lt:default:throw new Jt}}class Kt{constructor(t,r){c(this,"name");c(this,"program");c(this,"uniforms");c(this,"queue");c(this,"doubleSided");const n=new Map,s=[];for(const a of t.getUniformInfos())n.set(a.name,Pr(a,s));const i=Object.entries((r==null?void 0:r.aliases)||{});this.name=(r==null?void 0:r.name)??t.name,this.queue=(r==null?void 0:r.queue)??0,this.program=t,this.uniforms=n,this.doubleSided=!!(r!=null&&r.doubleSided);for(const[a,o]of i)if(!this.addAlias(a,o)&&!(r!=null&&r.quiet))throw new Error(`No such uniform: ${o}`);this.setUniformValues((r==null?void 0:r.uniforms)??{},r==null?void 0:r.quiet)}use(t){this.program.use(t);for(const r of this.uniforms.values())r.bind(t)}restore(t){this.program.restore(t)}addAlias(t,r){const n=this.uniforms.get(r);return n&&this.uniforms.set(t,n),n}removeAlias(t){const r=this.uniforms.get(t);if(r&&r.name!==t)return this.uniforms.delete(t),r}*getAliases(){for(const[t,r]of this.uniforms.entries())r.name!==t&&(yield[t,r.name])}getUniform(t){return this.uniforms.get(t)}*getUniforms(t=!1){for(const[r,n]of this.uniforms.entries())(t||n.name===r)&&(yield n)}setUniformValue(t,r,n,s){const i=/^(.*)\[(\d+)\]$/,a=t.match(i);if(n===void 0)if(a)n=Number(a[2]),isNaN(n)&&Y(new Error(`Invalid uniform name: ${t}`),s),n===0?this.doSetUniformValue(t,r,0,s):this.doSetUniformValue(a[1]+"[0]",r,n,s);else if(this.uniforms.has(t+"[0]"))if(typeof r=="object"&&typeof r.length=="number")for(let o=0;o<r.length;++o)this.doSetUniformValue(t+"[0]",r[o],o,s);else Y(new Error(`An array like object expected for ${t}`),s);else this.doSetUniformValue(t,r,0,s);else a&&Y(new Error("Invalid call: given a redundant index"),s),this.uniforms.has(t+"[0]")?this.doSetUniformValue(t+"[0]",r,n,s):n===0?this.doSetUniformValue(t,r,0,s):Y(new Error(`${t} is not an array`),s)}setUniformValues(t,r){for(const[n,s]of Object.entries(t))s!==void 0&&this.setUniformValue(n,s,void 0,r)}clone(t){const r={},n={};for(const[s,i]of this.uniforms)i.name===s?r[s]=i.get():n[s]=i.name;for(const[s,i]of Object.entries((t==null?void 0:t.uniforms)??{}))r[s]=i;for(const[s,i]of Object.entries((t==null?void 0:t.aliases)??{}))n[s]=i;return new Kt(this.program,{name:(t==null?void 0:t.name)??this.name,queue:(t==null?void 0:t.queue)??this.queue,quiet:(t==null?void 0:t.quiet)??!1,aliases:n,uniforms:r})}doSetUniformValue(t,r,n,s){const i=this.uniforms.get(t);i?i.set(r,n):Y(new Error(`No such uniform: ${t}`),s)}}function Nn(e,t){const r={};for(const s in t.attributes){const i=t.attributes[s],a=new st(e,e.ARRAY_BUFFER);a.bind(e).data(i.buffer,e.STATIC_DRAW),r[s]={...i,buffer:a}}let n;if(t.indices){const s=t.indices,i=new st(e,e.ELEMENT_ARRAY_BUFFER);i.bind(e).data(s.buffer,e.STATIC_DRAW),n={...s,buffer:i}}return{...t,attributes:r,indices:n}}class Nr{constructor(t,r,n){c(this,"geometry");c(this,"subMeshes");c(this,"vertexModel");c(this,"vao");c(this,"disabledAttribs");var o;const s=r.segments||[{offset:0,count:((o=r.indices)==null?void 0:o.count)??Rr(r)}],i=[],a=new wr(t);Ar(a,t,h=>{for(const u of n.locators){const l=u.name,d=r.attributes[l];if(d)u.type===void 0||u.type.startsWith("vec")?d.buffer.bind(t).vertexAttribPointer(u.location,d.rows||1,d.componentType,!!d.normalized,d.byteStride||0,d.byteOffset||0):d.buffer.bind(t).vertexAttribIPointer(u.location,d.rows||1,d.componentType,d.byteStride||0,d.byteOffset||0);else{let m;u.type==null||u.type.startsWith("vec")?m=new Float32Array(u.default||[0,0,0,1]):u.type.startsWith("ivec")?m=new Int32Array(u.default||[0,0,0,1]):m=new Uint32Array(u.default||[0,0,0,1]),i.push({location:u.location,value:m})}}r.indices&&r.indices.buffer.bind(t)}),this.geometry=r,this.subMeshes=s,this.vertexModel=n,this.disabledAttribs=i,this.vao=a}draw(t,r){for(const a of this.disabledAttribs)a.value instanceof Int32Array?t.vertexAttribI4iv(a.location,a.value):a.value instanceof Uint32Array?t.vertexAttribI4uiv(a.location,a.value):t.vertexAttrib4fv(a.location,a.value);const n=this.vao.bind(t),s=this.subMeshes[r],i=this.geometry.indices;if(i){const a=(i.byteOffset||0)+s.offset*Te(i.componentType);t.drawElements(this.geometry.drawMode,s.count,i.componentType,a)}else t.drawArrays(this.geometry.drawMode,s.offset,s.count);n.unbind()}}function Rr(e){const t=Object.values(e.attributes).map(r=>r.count);if(!t.length)throw new Error("No attributes are given");if(!t.every(r=>r===t[0]))throw new Error("All attributes must have the same count");return t[0]}function*Lr(e,t,r,n){for(const s of at(e,t,r,n))yield*s}function*at(e,t,r,n){r=r??0,n=n??e.count;const s=e.rows||1,i=e.columns||1,a=Te(e.componentType),o=e.columnByteLength||a*s,h=e.byteStride||o*i,u=Ur(e.componentType),l=[];for(let d=r;d<n;++d){for(let m=0;m<i;++m)for(let g=0;g<s;++g){const A=(e.byteOffset||0)+h*d+o*m+a*g;let y=u.call(t,A,!0);e.normalized&&(y=Dr(e.componentType,y)),l[m*s+g]=y}yield l.slice()}}function Ur(e){switch(e){case Ut:return DataView.prototype.getInt8;case Dt:return DataView.prototype.getUint8;case Ot:return DataView.prototype.getInt16;case tt:return DataView.prototype.getUint16;case G:return DataView.prototype.getInt32;case C:return DataView.prototype.getUint32;case I:return DataView.prototype.getFloat32;default:throw new Error("Unknown type")}}function Dr(e,t){switch(e){case Ut:return Math.max(t/127,-1);case Dt:return t/256;case Ot:return Math.max(t/32767,-1);case tt:return t/65536;case G:return Math.max(t/2147483647,-1);case C:return t/4294967296;default:return t}}function q(e){return e/180*Math.PI}function $(e){return e/Math.PI*180}function W(e,t,r){return Math.max(t,Math.min(e,r))}class k{constructor(t,r,n,s){c(this,"x");c(this,"y");c(this,"w");c(this,"h");this.x=t,this.y=r,this.w=n,this.h=s}denormalize(t,r){return new k(this.x*t,this.y*r,this.w*t,this.h*r)}validate(){let t=this.x,r=this.y,n=this.w,s=this.h;return n<0&&([t,n]=[t+n,-n]),s<0&&([r,s]=[r+s,-s]),new k(t,r,n,s)}clip(t){let r=W(this.left,t.left,t.right),n=W(this.bottom,t.bottom,t.top),s=W(this.right,t.left,t.right),i=W(this.top,t.bottom,t.top);return new k(r,n,s-r,i-n)}map(t){return new k(t(this.x),t(this.y),t(this.w),t(this.h))}get right(){return this.x+this.w}get top(){return this.y+this.h}get left(){return this.x}get bottom(){return this.y}get aspectRatio(){return this.w/this.h}}class ot{constructor(t,r){c(this,"value");r==="deg"?this.value=q(t):this.value=t}static rad(t){return new ot(t,"rad")}static deg(t){return new ot(t,"deg")}fromRad(t){this.value=t}fromDeg(t){this.value=q(t)}toRad(){return this.value}toDeg(){return $(this.value)}}function xe(e,t,r){return e+r*(t-e)}const Or=1e-6;function oe(e,t){return Math.abs(e-t)<=Or}function ce(e){return e%=Math.PI*2,e>Math.PI?e-2*Math.PI:e<-Math.PI?e+2*Math.PI:e}function Vr(e,t){t=t||z();const r=e[0],n=e[1],s=e[2],i=e[3],a=i*r,o=i*n,h=i*s,u=r*n,l=r*s,d=n*s,m=r*r,g=n*n,A=s*s,y=-2*(d-a),v=2*(u+h),T=1-2*(m+A),M=2*(o+l),E=1-2*(m+g);if(oe(v,0)&&oe(T,0)){const f=2*(u-h),w=1-2*(g+A),b=$(Math.atan2(f,w)),_=t[2];return[90-_,b,_]}else{const f=Math.atan2(Math.sqrt(1+y),Math.sqrt(1-y)),w=R($(ce(2*f-Math.PI/2)),$(Math.atan2(M,E)),$(Math.atan2(v,T))),b=R($(ce(-Math.PI/2-2*f)),$(Math.atan2(-M,-E)),$(Math.atan2(-v,-T)));return ee(w,t)<ee(b,t)?w:b}}class Fr{constructor(){c(this,"quaternion");c(this,"eulerAngles");this.quaternion=B(),this.eulerAngles=z()}getEuler(){return Z(this.eulerAngles)}setEuler(t){const r=this.quaternion;He(r),qe(r,r,q(t[1])),je(r,r,q(t[0])),Qe(r,r,q(t[2])),this.eulerAngles=Z(t)}getQuat(){return re(this.quaternion)}setQuat(t){this.eulerAngles=Vr(t,this.eulerAngles),this.quaternion=re(t)}}class Cr{constructor(){c(this,"translation");c(this,"rotation");c(this,"scale");this.translation=z(),this.rotation=new Fr,this.scale=R(1,1,1)}matrix(t){Ve(t,this.rotation.getQuat(),this.translation,this.scale)}}class zr{constructor(t,r){c(this,"parent");c(this,"name");c(this,"trs");c(this,"localMatrix");c(this,"globalMatrix");c(this,"take");c(this,"enabled");c(this,"components");this.parent=t,this.name=r,this.trs=new Cr,this.localMatrix=L(),this.globalMatrix=L(),this.take=0,this.enabled=!0,this.components=[]}preUpdate(t){var r;if(this.enabled)for(const n of this.components)(r=n.preUpdate)==null||r.call(n,this,t)}update(t){this.take!==t&&(this.trs.matrix(this.localMatrix),this.parent?(this.parent.update(t),de(this.globalMatrix,this.parent.globalMatrix,this.localMatrix)):ht(this.globalMatrix,this.localMatrix),this.take=t)}postUpdate(){var t;if(this.enabled)for(const r of this.components)(t=r.postUpdate)==null||t.call(r,this)}addComponent(t){this.components.push(t)}removeComponent(t){const r=this.components.findIndex(n=>n===t);0<=r&&this.components.splice(r,1)}get position(){return ge(z(),z(),this.globalMatrix)}get forward(){const t=R(0,0,-1),r=Ue(ut(),this.globalMatrix);return Be(z(),t,r)}}class Rn{constructor(t,r,n){c(this,"fovy");c(this,"near");c(this,"far");this.fovy=t,this.near=r,this.far=n}matrix(t,r){return Ce(t,this.fovy.toRad(),r,this.near,this.far)}}class $r{constructor(t,r,n,s){c(this,"view");c(this,"proj");c(this,"position");c(this,"inverseView");c(this,"inverseProj");n||(n=L(),t&&nt(n,t)),s||(s=L(),r&&nt(s,r));const i=ge(z(),R(0,0,0),n);this.view=t??L(),this.proj=r??L(),this.position=i,this.inverseView=n,this.inverseProj=s}get inverseViewProj(){return pe(L(),this.inverseView,this.inverseProj)}}class Ln{constructor(t,r,n){c(this,"node");c(this,"order");c(this,"normalizedViewportRect");c(this,"cullMask");c(this,"projection");this.node=t,this.order=r,this.projection=n,this.normalizedViewportRect=new k(0,0,1,1),this.cullMask=2147483647}update(t){this.node.update(t)}viewport(t,r){const n=new k(0,0,t,r);return this.normalizedViewportRect.validate().denormalize(n.w,n.h).clip(n)}prepare(t){Number.isFinite(t)||(t=1);const r=L();nt(r,this.node.globalMatrix);const n=L();return this.projection.matrix(n,t),new $r(r,n,this.node.globalMatrix)}}function kr(e,t,r){const n=Oe(ut(),t);e.setUniformValues({model:t,inverseTranspose:n,view:r.view,proj:r.proj,viewPos:r.position,viewPosition:r.position,inverseView:r.inverseView,inverseProj:r.inverseProj,inverseViewProj:r.inverseViewProj},!0)}function Br(e,t,r,n,s){kr(s,r,n),s.use(e);for(let i=0;i<t.subMeshes.length;++i)t.draw(e,i)}class Gr{constructor(t,r,n,s,i=1){c(this,"mesh");c(this,"material");c(this,"node");c(this,"layer");this.node=r,this.mesh=n,this.material=s,this.layer=i}draw(t,r){var s;const n=((s=this.node)==null?void 0:s.globalMatrix)??L();Br(t,this.mesh,n,r,this.material)}}class Un extends Gr{constructor(r,n,s,i,a,o=1){super(r,n,s,i,o);c(this,"skin");this.skin=a}draw(r,n){const s=this.skin.joints.map(i=>i.globalMatrix);this.material.setUniformValues({jointMatrices:s},!0),super.draw(r,n)}}class Dn{constructor(t,r,n,s=1){c(this,"mesh");c(this,"material");c(this,"layer");this.material=n,this.mesh=r,this.layer=s}draw(t,r){const n=L();ht(n,r.inverseView);for(let i=12;i<15;++i)n[i]=0;const s=pe(L(),n,r.inverseProj);this.material.setUniformValues({inverseViewProj:s}),this.material.use(t),this.mesh.draw(t,0)}}class On{constructor(){c(this,"scrollDelta");c(this,"dragDelta");this.scrollDelta=0,this.dragDelta=[0,0]}reset(){this.scrollDelta=0,this.dragDelta[0]=0,this.dragDelta[1]=0}scroll(t){this.scrollDelta+=t}drag(t,r){this.dragDelta[0]+=t,this.dragDelta[1]+=r}}function Xr(e){return e*e*(3-2*e)}function Yr(e,t,r){let n=e.input.findIndex(i=>i>t);if(n<0)return e.output[e.input.length-1];if(n===0)return e.output[0];let s=n-1;return e.output[s]}function Hr(e,t,r){let n=e.input.findIndex(u=>u>t);if(n<0)return e.output[e.input.length-1];if(n===0)return e.output[0];let s=n-1;const i=e.input[n]-e.input[s],a=Xr((t-e.input[s])/i),o=e.output[s],h=e.output[n];if(r==="rotation"){const u=B();return j(u,o,h,a),Array.from(u)}else{const u=[];for(let l=0;l<o.length;++l)u[l]=xe(o[l],h[l],a);return u}}function Wr(e,t,r){let n=e.input.findIndex(u=>u>t);if(n<0)return e.output[e.input.length-1];if(n===0)return e.output[0];let s=Math.max(0,n-1);const i=e.input[n]-e.input[s],a=(t-e.input[s])/i,o=e.output[s*3],h=e.output[n*3];if(r==="rotation"){const u=B();return j(u,o,h,a),Array.from(u)}else{const u=[];for(let l=0;l<o.length;++l)u[l]=xe(o[l],h[l],a);return u}}class Vn{constructor(t,r,n,s,i){c(this,"rotator");c(this,"translator");c(this,"inputSystem");c(this,"minDistance");c(this,"maxDistance");this.rotator=t,this.translator=r,this.inputSystem=n,this.minDistance=s,this.maxDistance=i}preUpdate(t,r){const s=this.rotator.trs.rotation.getEuler();s[0]-=this.inputSystem.dragDelta[1]*.5,s[1]-=this.inputSystem.dragDelta[0]*.5,this.rotator.trs.rotation.setEuler(s);const i=.1,a=this.translator.trs.translation;a[2]=W(a[2]+this.inputSystem.scrollDelta*i,this.minDistance,this.maxDistance)}}class Fn{constructor(t){c(this,"animations");c(this,"time");c(this,"state");c(this,"current");this.animations=t,this.time=0,this.state="stop",this.current=-1}selectAnimation(t){if(t<0||t>=this.animations.length)throw new RangeError(`index must be in range [0, ${this.animations.length})`);t!==this.current&&(this.current=t,this.time=0)}preUpdate(t,r){this.state==="play"&&(this.time+=r);const n=this.animations[this.current],s=this.time%n.timeLength;for(const i of n.channels){if(!i.node)continue;const a=jr(i.sampler,s,i.path);switch(i.path){case"translation":Zt(i.node.trs.translation,a);break;case"rotation":i.node.trs.rotation.setQuat(a);break;case"scale":Zt(i.node.trs.scale,a);break}}}play(){this.current>=0&&(this.state="play")}pause(){this.current>=0&&(this.state="pause")}stop(){this.time=0,this.state="stop"}get currentAnimation(){return this.animations[this.current]}}function jr(e,t,r){switch(e.interpolation){case"STEP":return Yr(e,t);case"CUBICSPLINE":return Wr(e,t,r);default:return Hr(e,t,r)}}class Me{}class qr extends Me{constructor(r){super();c(this,"typeTag");this.typeTag=r}check(r,n){r===void 0||N(r,this.typeTag,n)}}function p(e){return new qr(e)}class _e{constructor(t){c(this,"parent");this.parent=t}toString(){return(this.parent?this.parent.toString():"")+this.toStringSelf()}}class Qr extends _e{constructor(r,n){super(n);c(this,"name");this.name=r}toStringSelf(){return"."+this.name}}class Jr extends _e{constructor(r,n){super(n);c(this,"index");this.index=r}toStringSelf(){return"["+this.index+"]"}}function N(e,t,r){function n(){return r?r.toString()+": ":""}if(t instanceof Me)t.check(e,r);else if(typeof t=="string")switch(t){case"number":case"boolean":case"string":if(typeof e!==t)throw new Error(`${n()}${e} is not a ${t}`);break;default:throw new Error(`unsupported type tag: ${t}`)}else if(Array.isArray(t)){if(!Array.isArray(e))throw new Error(`${n()}${e} is not an array`);if(t.length===1)for(let s=0;s<e.length;++s)N(e[s],t[0],new Jr(s,r));else if(t.length>1)throw new Error("tuple is not supported")}else if(t&&typeof t=="object"){if(!e||typeof e!="object")throw new Error(`${n()}${e} is not an object`);for(const s in t)N(e[s],t[s],new Qr(s,r))}}const ue=34962,Kr=34963,Zr=5120,tn=5121,en=5122,rn=5123,nn=5125,Se=5126;function sn(e){try{if(N(e,{asset:{version:"string",copyright:p("string"),generator:p("string"),minVersion:p("string")},extensionsUsed:p(["string"]),extensionsRequired:p(["string"]),scene:p("number")}),e.accessors&&N(e.accessors,[{componentType:"number",count:"number",type:"string",bufferView:p("number"),byteOffset:p("number"),normalized:p("boolean"),max:p(["number"]),min:p(["number"]),sparse:p({}),name:p("string"),extensions:p({})}]),e.animations&&N(e.animations,[{channels:[{sampler:"number",target:{node:p("number"),path:"string",extensions:p({})},extensions:p({})}],samplers:[{input:"number",interpolation:p("string"),output:"number",extensions:p({})}],name:p("string"),extensions:p({})}]),e.buffers&&N(e.buffers,[{uri:p("string"),byteLength:"number",name:p("string"),extensions:p({})}]),e.bufferViews&&N(e.bufferViews,[{buffer:"number",byteOffset:p("number"),byteLength:"number",byteStride:p("number"),target:p("number"),name:p("string"),extensions:p({})}]),e.cameras&&N(e.cameras,[{orthographic:p({xmag:"number",ymag:"number",zfar:"number",znear:"number",extensions:p({})}),perspective:p({aspectRatio:p("number"),yfov:"number",zfar:p("number"),znear:"number",extensions:p({})}),type:"string",name:p("string"),extensions:p({})}]),e.meshes){N(e.meshes,[{primitives:[{attributes:{},indices:p("number"),material:p("number"),mode:p("number"),targets:p([{}]),extensions:p({})}],weights:p(["number"]),name:p("string"),extensions:p({})}]);for(const t of e.meshes)for(const r of t.primitives)if(!Object.values(r.attributes).every(n=>typeof n=="number"))throw new Error("mesh.primitive.attributes must have only number values")}if(e.nodes){N(e.nodes,[{camera:p("number"),children:p(["number"]),skin:p("number"),matrix:p(["number"]),mesh:p("number"),rotation:p(["number"]),scale:p(["number"]),translation:p(["number"]),weights:p(["number"]),name:p("string"),extensions:p({})}]);for(const t of e.nodes){if(t.matrix&&t.matrix.length!=16)throw new Error("node.matrix must have 16 elements");if(t.rotation&&t.rotation.length!=4)throw new Error("node.rotation must have 4 elements");if(t.scale&&t.scale.length!=3)throw new Error("node.scale must have 3 elements");if(t.translation&&t.translation.length!=3)throw new Error("node.translation must have 3 elements")}}return e.scenes&&N(e.scenes,[{node:p(["number"]),name:p("string"),extensions:p({})}]),e.skins&&N(e.skins,[{inverseBindMatrices:p("number"),skeleton:p("number"),joints:["number"]}]),e.images&&N(e.images,[{uri:p("string"),mimeType:p("string"),bufferView:p("number"),name:p("string")}]),e.samplers&&N(e.samplers,[{magFilter:p("number"),minFilter:p("number"),wrapS:p("number"),wrapT:p("number"),name:p("string")}]),e.textures&&N(e.textures,[{sampler:p("number"),source:p("number"),name:p("string")}]),e}catch(t){const r="Inavild glTF file: ";throw t instanceof Error?(t.message=r+t.message,t):new Error("Invalid glTF file: "+String(t))}}function an(e,t){return Ie(e,t)*e.count}function Ie(e,t){const[r,n]=Pe(e.type);return t?on(r*he(e.componentType),4)*n:r*he(e.componentType)*n}function he(e){switch(e){case Zr:return 1;case tn:return 1;case en:return 2;case rn:return 2;case nn:return 4;case Se:return 4;default:throw new Error("Invalid component type code: "+e)}}function on(e,t){const r=e+(t-1),n=r%t;return r-n}function Pe(e){switch(e){case"SCALAR":return[1,1];case"VEC2":return[2,1];case"VEC3":return[3,1];case"VEC4":return[4,1];case"MAT2":return[2,2];case"MAT3":return[3,3];case"MAT4":return[4,4];default:throw new Error("Invalid accessor type: "+e)}}function cn(e){const t=R(e[12],e[13],e[14]),r=[R(e[0],e[1],e[2]),R(e[4],e[5],e[6]),R(e[8],e[9],e[10])],n=R(J(r[0]),J(r[1]),J(r[2])),s=Q(z(),r[0],r[1]);be(s,r[2])<0&&(n[2]=-n[2]);for(let o=0;o<3;++o)Le(n[o],0)||$e(r[o],r[o],1/n[o]);const a=we(B(),De(r[0][0],r[0][1],r[0][2],r[1][0],r[1][1],r[1][2],r[2][0],r[2][1],r[2][2]));return{translation:[t[0],t[1],t[2]],rotation:[a[0],a[1],a[2],a[3]],scale:[n[0],n[1],n[2]]}}function un(e){return async function(t){if(!t)throw new Error("Can't fetch buffer data. URI not found");const r=new URL(t,e),n=await fetch(r);if(!n.ok)throw new Error("failed to fetch data from: "+t);return n.arrayBuffer()}}function hn(e){return/\.png$/i.test(e)?"image/png":/\.jpe?g$/i.test(e)?"image/jpeg":""}function fn(e,t){const r=[],n=Math.min(e.length,t.length);for(let s=0;s<n;++s)r.push([e[s],t[s]]);return r}async function ln(e,t){const r=e.map(n=>t(n));return fn(e,Array.from(await Promise.allSettled(r)))}async function mn(e,t,r,n){var g,A,y,v,T,M,E;const s=(e.buffers||[]).map(f=>t(f.uri)),a=(await Promise.all(s)).map((f,w)=>{const b=e.buffers[w];if(f.byteLength<b.byteLength)throw new Error(`fetched data is smaller(${f.byteLength}) than expected(${b.byteLength})`);return{...b,data:f}}),o=(e.bufferViews||[]).map(f=>({...f}));async function h(f){let w;if(f.uri){const b=hn(f.uri);w=new Blob([await t(f.uri)],{type:b})}else{const b=o[f.bufferView],_=a[b.buffer],S=new DataView(_.data,b.byteOffset,b.byteLength);w=new Blob([S],{type:f.mimeType})}return await createImageBitmap(w)}const u=(e.images||[]).map(f=>({...f}));if(n)for(const[f,w]of await ln(u,h)){const{status:b,value:_,reason:S}=w;b==="fulfilled"?f.bitmap=_:f.error=S}const l=(e.textures||[]).map(f=>({...f}));for(const f of e.materials||[]){const w={normal:H((g=f.normalTexture)==null?void 0:g.index,b=>l[b]),occulusion:H((A=f.occlusionTexture)==null?void 0:A.index,b=>l[b]),emissive:H((y=f.emissiveTexture)==null?void 0:y.index,b=>l[b]),baseColor:H((T=(v=f.pbrMetallicRoughness)==null?void 0:v.baseColorTexture)==null?void 0:T.index,b=>l[b]),metallicRoughness:H((E=(M=f.pbrMetallicRoughness)==null?void 0:M.metallicRoughnessTexture)==null?void 0:E.index,b=>l[b])};for(const[b,_]of Object.entries(w))_&&(_.usages=(_.usages||[]).concat(b))}const d=(e.accessors||[]).map(f=>({...f,bufferView:f.bufferView??-1})),m=(e.skins||[]).map(f=>({...f}));for(const f of e.meshes||[])for(const w of f.primitives){for(const b of Object.values(w.attributes))d[b].target=ue;w.indices!==void 0&&(d[w.indices].target=Kr)}for(const f of d){if(f.bufferView===-1){const w=an(f,f.target===ue),b=new ArrayBuffer(w),_={byteLength:w,data:b};r&&r(f,b);const S={buffer:a.length,byteLength:w};f.bufferView=o.length,a.push(_),o.push(S)}f.target!==void 0&&(o[f.bufferView].target=f.target),delete f.target}for(const f of m)if(f.inverseBindMatrices===void 0){const w=Array.from(L()),b=Array(f.joints.length).fill(w),_=new Float32Array(b.flat()).buffer,S=_.byteLength,D={byteLength:S,data:_},U={buffer:a.length,byteLength:S},O={bufferView:o.length,componentType:Se,count:f.joints.length,type:"MAT4",min:w,max:w};f.inverseBindMatrices=d.length,d.push(O),a.push(D),o.push(U)}return{...e,buffers:a,bufferViews:o,images:u,accessors:d,skins:m,textures:l}}function H(e,t){return e===void 0?void 0:t(e)}class fe extends Error{constructor(t){super(t)}}class Cn{constructor(){c(this,"ticket");this.ticket={}}dispose(t){this.ticket.errorMessage=t,this.ticket={}}checkTicket(t){if(t!==this.ticket)throw new fe(t.errorMessage)}loadImage(t){return new Promise((r,n)=>{const s=this.ticket,i=new Image;i.onerror=n,i.onload=()=>{s!==this.ticket?n(new fe(s.errorMessage)):r(i)},i.src=t})}async loadImageBitmap(t,r){const n=this.ticket,s=await this.loadImage(t),i=await createImageBitmap(s,r);return this.checkTicket(n),i}async loadImageBitmapCube(t,r){const n=this.ticket,s=await Promise.all(t.map(i=>this.loadImageBitmap(i,r)));return this.checkTicket(n),s}async loadGltf(t,r){const n=this.ticket,s=await fetch(t);if(!s.ok)throw new Error("failed to fetch: "+t);const i=await s.text();this.checkTicket(n);const a=JSON.parse(i),o=await mn(sn(a),un(t),void 0,r);return this.checkTicket(n),o}}class dn{constructor(t,r){c(this,"min");c(this,"max");this.min=t,this.max=r}normalize(t){const r=ne(K(),this.max,this.min),n=ne(K(),t,this.min);return Ze(K(),n,r)}}class zn{static createSphere(t,r,n,s){n=Math.max(3,n),s=Math.max(2,s);const i=Math.PI,a=(s+1)*(n+1),o=[],h=[],u=[];for(let d=0;d<=s;++d)for(let m=0;m<=n;++m){const g=m/n*2*i,A=-i/2+d/s*i,y=Math.cos(A),v=Math.sin(A),T=Math.cos(g),M=Math.sin(g),E=y*T,f=v,w=-y*M;h.push(E,f,w),o.push(E*r,f*r,w*r),u.push(m/n,d/s)}const l=[];for(let d=0;d<s;++d)for(let m=0;m<n;++m){const g=d*(n+1)+m,A=g+1,y=g+n+1,v=y+1;d!==0&&l.push(g,A,y),d!=s-1&&l.push(y,A,v)}return{name:t,attributes:{POSITION:{buffer:new Float32Array(o),rows:3,componentType:I,count:a},TEXCOORD_0:{buffer:new Float32Array(u),rows:2,componentType:I,count:a},NORMAL:{buffer:new Float32Array(h),rows:3,componentType:I,count:a}},indices:{buffer:new Uint32Array(l),componentType:C,count:l.length},drawMode:X}}static createCube(t,r,n,s){s=s??[0,0,0];const i=[[-.5,.5,-.5],[-.5,.5,.5],[.5,.5,.5],[.5,.5,-.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,-.5,.5],[-.5,-.5,.5],[-.5,.5,.5],[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[.5,.5,-.5],[.5,-.5,-.5],[-.5,-.5,-.5],[-.5,.5,-.5],[.5,.5,.5],[.5,-.5,.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5],[-.5,-.5,-.5],[-.5,-.5,.5],[-.5,.5,.5]],a=[[0,0],[0,1],[1,1],[1,0],[0,0],[1,0],[1,1],[0,1],[0,1],[0,0],[1,0],[1,1],[1,1],[1,0],[0,0],[0,1],[1,1],[0,1],[0,0],[1,0],[1,0],[0,0],[0,1],[1,1]];let o=[[0,1,0],[0,1,0],[0,1,0],[0,1,0],[0,-1,0],[0,-1,0],[0,-1,0],[0,-1,0],[0,0,1],[0,0,1],[0,0,1],[0,0,1],[0,0,-1],[0,0,-1],[0,0,-1],[0,0,-1],[1,0,0],[1,0,0],[1,0,0],[1,0,0],[-1,0,0],[-1,0,0],[-1,0,0],[-1,0,0]],h=[[1,0,0,-1],[1,0,0,-1],[1,0,0,-1],[1,0,0,-1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,-1],[1,0,0,-1],[1,0,0,-1],[1,0,0,-1],[0,1,0,1],[0,1,0,1],[0,1,0,1],[0,1,0,1],[0,1,0,-1],[0,1,0,-1],[0,1,0,-1],[0,1,0,-1]];const u=[0,1,2,2,3,0,4,5,6,6,7,4,8,9,10,10,11,8,12,13,14,14,15,12,16,17,18,18,19,16,20,21,22,22,23,20];r&&(u.reverse(),o=o.map(m=>m.map(g=>-1*g)),h=h.map(m=>[m[0],m[1],m[2],-m[3]]));function l(m,g){return[m[0]*g[0],m[1]*g[1],m[2]*g[2]]}function d(m,g){return[m[0]+g[0],m[1]+g[1],m[2]+g[2]]}return{name:t,attributes:{POSITION:{buffer:new Float32Array(i.map(m=>d(s,l(m,n))).flat()),rows:3,componentType:I,count:24},TEXCOORD_0:{buffer:new Float32Array(a.flat()),rows:2,componentType:I,count:24},NORMAL:{buffer:new Float32Array(o.flat()),rows:3,componentType:I,count:24}},indices:{buffer:new Uint32Array(u),componentType:C,count:36},drawMode:X}}static createQuad(t){const r=[-1,-1,1,-1,1,1,-1,1],n=r.map(a=>a*.5+.5),s=[0,0,1,0,0,1,0,0,1,0,0,1],i=[0,1,2,2,3,0];return{name:t,attributes:{POSITION:{buffer:new Float32Array(r),rows:2,componentType:I,count:4},TEXCOORD_0:{buffer:new Float32Array(n),rows:2,componentType:I,count:4},NORMAL:{buffer:new Float32Array(s),rows:3,componentType:I,count:4}},indices:{buffer:new Uint16Array(i),componentType:tt,count:6},drawMode:X}}static createBackdrop(t){const r=[-1,-1,1,1,-1,1,1,1,1,-1,1,1],n=[0,1,2,2,3,0];return{name:t,attributes:{POSITION:{buffer:new Float32Array(r),rows:3,componentType:I,count:4}},indices:{buffer:new Uint32Array(n),componentType:C,count:6},drawMode:X}}static createPlane(t,r,n,s){if(s<1)throw new Error(`slices should be greater than or equal to 1, but ${s}`);s=Math.floor(s);const i=R(-r/2,-n/2,0),a=R(r/2,n/2,0),o=r/s,h=n/s,u=Z(i),l=[],d=[],m=new dn(et(i[0],i[1]),et(a[0],a[1]));for(let v=0;v<s+1;++v){u[0]=i[0];for(let T=0;T<s+1;++T)l.push(Z(u)),d.push(m.normalize(et(u[0],u[1]))),u[0]+=o;u[1]+=h}const g=R(0,0,1),A=Array(l.length).fill(g),y=[];for(let v=0;v<s;++v)for(let T=0;T<s;++T){let M=(s+1)*v+T,E=M+1,f=M+(s+1),w=f+1;y.push(M),y.push(E),y.push(f),y.push(f),y.push(E),y.push(w)}return{name:t,attributes:{POSITION:{buffer:new Float32Array(l.map(v=>Array.from(v)).flat()),rows:3,componentType:I,count:l.length},TEXCOORD_0:{buffer:new Float32Array(d.map(v=>Array.from(v)).flat()),rows:2,componentType:I,count:l.length},NORMAL:{buffer:new Float32Array(A.map(v=>Array.from(v)).flat()),rows:3,componentType:I,count:l.length}},indices:{buffer:new Uint32Array(y),componentType:C,count:y.length},drawMode:X}}}function pn(e){return e*e}function ct(e,t){return e.map((r,n)=>r-t[n])}function bn(e){return Math.sqrt(gn(e))}function gn(e){let t=0;for(let r=0;r<e.length;++r)t+=pn(e[r]);return t}class $n{constructor(t,r){c(this,"clickPos");c(this,"currentPos");c(this,"button");c(this,"trails");c(this,"dragging");c(this,"count");c(this,"threshold");c(this,"onDrag");this.trails=0,this.dragging=!1,this.count=-1,this.threshold=r??2,this.onDrag=t}mouseDown(t){this.clickPos===void 0&&(this.currentPos=this.clickPos=[t.clientX,t.clientY],this.button=t.button)}mouseUp(t){this.clickPos===void 0||this.button!==t.button||(this.onDrag({button:t.button,startPos:this.clickPos,currentPos:this.currentPos,delta:[0,0],done:!0,count:this.count+1}),delete this.clickPos,delete this.currentPos,delete this.button,this.trails=0,this.dragging=!1)}mouseMove(t){if(this.clickPos===void 0)return;const r=this.currentPos;this.currentPos=[t.clientX,t.clientY];const n=ct(this.currentPos,r);this.trails+=bn(n),this.dragging?(this.count++,this.onDrag({button:t.button,startPos:this.clickPos,currentPos:this.currentPos,delta:n,done:!1,count:this.count})):this.trails>this.threshold&&(this.dragging=!0,this.count=0,this.onDrag({button:t.button,startPos:this.clickPos,currentPos:this.currentPos,delta:ct(this.currentPos,this.clickPos),done:!1,count:0}))}}function le(e,t){const r=[];for(let n=0;n<e.length;++n){const s=e[n];if(s.target!==t)continue;const i=[s.clientX,s.clientY];r.push({id:s.identifier,startPos:i,currentPos:i,delta:[0,0]})}return r}function wn(e){for(let t=1;t<e.length;++t)if(e[t].target!==e[0].target)return!1;return!0}class kn{constructor(t){c(this,"target");c(this,"callback");c(this,"touchDrags");this.callback=t,this.touchDrags=[]}touchStart(t){!this.target&&wn(t.touches)&&(this.target=t.touches[0].target),this.touchDrags=le(t.touches,this.target),this.target&&t.preventDefault()}touchEnd(t){this.target&&(t.preventDefault(),this.touchDrags=le(t.touches,this.target),this.touchDrags.length||delete this.target)}touchMove(t){if(this.target){t.preventDefault();for(let r=0;r<t.touches.length;++r){const n=t.touches[r];if(n.target!==this.target)continue;const s=this.touchDrags.find(h=>h.id==n.identifier);if(!s)throw new Error("Logic Error: touchMove");const i=s.currentPos,a=[n.clientX,n.clientY],o=ct(a,i);s.currentPos=a,s.delta=o}this.callback({touchDrags:this.touchDrags})}}}function Bn(e,t){e.width=e.clientWidth,e.height=e.clientHeight;for(let r=window.devicePixelRatio;r>1;r/=2){const n=Math.round(e.clientWidth*r),s=Math.round(e.clientHeight*r);if(n<=1024){e.width=n,e.height=s;break}}}function Gn(e){const t=e.getContext("webgl2");if(!t)throw new Error("This browser does not support WebGL2");let r=t;for(const n of["EXT_color_buffer_float"])if(!r.getExtension(n))throw new Error(`This browser does not support extension: ${n}`);return r}class Xn{constructor(t,r,n,s){c(this,"gl");c(this,"standardProgram");c(this,"usage");c(this,"root");c(this,"buffers");c(this,"accessors");c(this,"nodes");c(this,"meshes");c(this,"skins");c(this,"animations");c(this,"textures");c(this,"ourMaterials");this.gl=t,this.standardProgram=r,this.root=n,this.usage=s,this.buffers=[],this.accessors=[],this.nodes=[],this.meshes=[],this.skins=[],this.animations=[],this.textures=[],this.ourMaterials=[]}start(){this.buffers.length=0,this.accessors.length=0,this.nodes.length=0,this.meshes.length=0,this.skins.length=0,this.animations.length=0,this.textures.length=0,this.ourMaterials.length=0}finish(){}addBufferView(t,r,n){let s;return n&&(s=new st(this.gl,n),s.bind(this.gl).data(t,this.usage)),this.buffers.push({dataView:t,bufferObject:s,byteStride:r}),this.buffers.length-1}addAccessor(t){var u;const r=this.buffers[t.bufferView],[n,s]=Pe(t.type),i=((u=r.bufferObject)==null?void 0:u.target)===34962,a=Ie(t,i),o=a/s,h=r.byteStride||a;return this.accessors.push({componentType:t.componentType,count:t.count,normalized:!!t.normalized,byteOffset:t.byteOffset||0,buffer:t.bufferView,rows:n,columns:s,columnByteLength:o,byteStride:h}),this.accessors.length-1}addAnimation(t){const r=t.samplers.map(i=>{const a=this.accessors[i.input],o=this.buffers[a.buffer].dataView,h=this.accessors[i.output],u=this.buffers[h.buffer].dataView,l=Array.from(Lr(a,o)),d=Array.from(at(h,u));return{input:l,output:d,interpolation:i.interpolation}}),n=t.channels.map(i=>({node:rt(i.target.node,a=>this.nodes[a]),sampler:r[i.sampler],path:i.target.path})),s=Math.max(...r.map(i=>i.input[i.input.length-1]));return this.animations.push({channels:n,samplers:r,timeLength:s,name:t.name}),this.animations.length-1}addNode(t){return this.nodes.push(new zr(this.root,t)),this.nodes.length-1}setNodeParent(t,r){this.nodes[t].parent=this.nodes[r]}setNodeScale(t,r,n,s){te(this.nodes[t].trs.scale,r,n,s)}setNodeRotation(t,r,n,s,i){this.nodes[t].trs.rotation.setQuat([r,n,s,i])}setNodeTranslation(t,r,n,s){te(this.nodes[t].trs.translation,r,n,s)}addMesh(t,r,n,s){const i={};for(const o in n){const h=this.accessors[n[o]],u=this.buffers[h.buffer].bufferObject;if(!u)throw new Error(`Invalid attribute: ${o}: ${h}`);i[o]={...h,buffer:u}}const a={name:t,drawMode:r,attributes:i};if(s!==void 0){const o=this.accessors[s],h=this.buffers[o.buffer].bufferObject;if(!h)throw new Error(`Invalid indices: ${s}`);a.indices={...o,buffer:h}}return this.meshes.push(new Nr(this.gl,a,this.standardProgram.vertexModel)),this.meshes.length-1}addSkin(t,r,n){const s=this.accessors[r];if(s.componentType!==this.gl.FLOAT||s.rows!==4||s.columns!==4){const o="${this.gl.FLOAT} 4x4",h=`${s.componentType} ${s.rows}x${s.columns}`;throw new Error(`skin.inverseBindMatrices must refers to ${o} but ${h}`)}const i=Array.from(at(s,this.buffers[s.buffer].dataView)).map(o=>ht(L(),o)),a={joints:t.map(o=>this.nodes[o]),inverseBindMatrices:i};return n!==void 0&&(a.skeleton=this.nodes[n]),this.skins.push(a),this.skins.length-1}addTexture(t,r,n){if(!r.bitmap||r.bitmap.width===0||r.bitmap.height===0)this.textures.push(null);else{const s=r.bitmap.width,i=r.bitmap.height;let a=this.gl.RGBA8;(n==null?void 0:n.length)===1&&n[0]==="baseColor"&&(a=this.gl.SRGB8_ALPHA8);const o=Tr(Math.min(s,i)),h=o===1?this.gl.LINEAR:this.gl.LINEAR_MIPMAP_LINEAR,u=new Mr(this.gl,this.gl.TEXTURE_2D,o,a,s,i);u.bind(this.gl),u.bind(this.gl).subImage2D(this.gl.TEXTURE_2D,0,0,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,r.bitmap).parameteri(this.gl.TEXTURE_MIN_FILTER,t.minFilter??h).parameteri(this.gl.TEXTURE_MAG_FILTER,t.magFilter??this.gl.LINEAR).parameteri(this.gl.TEXTURE_WRAP_S,t.wrapS??this.gl.REPEAT).parameteri(this.gl.TEXTURE_WRAP_T,t.wrapT??this.gl.REPEAT).generateMipmap().unbind(),this.textures.push(u)}return this.textures.length-1}addMaterial(t){const r=this.createMaterial();r.setUniformValues({alphaCutoff:t.alphaCutoff??0},!0),t.normalTexture&&r.setUniformValues({normalMap:this.textures[t.normalTexture.index],normalMapStrength:t.normalTexture.scale||1},!0),t.occlusionTexture&&r.setUniformValues({occlusionMap:this.textures[t.occlusionTexture.index],occlusionFactor:t.occlusionTexture.strength??1},!0);const n=t.pbrMetallicRoughness,s=(n==null?void 0:n.baseColorFactor)??[1,1,1,1],i=(n==null?void 0:n.roughnessFactor)??1,a=(n==null?void 0:n.metallicFactor)??1,o=rt(n==null?void 0:n.baseColorTexture,u=>this.textures[u.index]),h=rt(n==null?void 0:n.metallicRoughnessTexture,u=>this.textures[u.index]);return r.setUniformValues({baseColorValue:s,metallicFactor:a,roughnessFactor:i,baseColorMap:o,metallicRoughnessMap:h},!0),this.ourMaterials.push(r),this.ourMaterials.length-1}linkNodeMesh(t,r,n,s){}createMaterial(){return new Kt(this.standardProgram)}}function rt(e,t){return e===void 0?void 0:t(e)}function Yn(e,t){t.start();for(const i of e.bufferViews||[]){const a=e.buffers[i.buffer],o=new DataView(a.data,i.byteOffset||0,i.byteLength);t.addBufferView(o,i.byteStride,i.target)}for(const i of e.accessors||[])t.addAccessor(i);for(const i of e.textures||[]){if(i.sampler===void 0||i.source===void 0)continue;const a=e.samplers[i.sampler],o=e.images[i.source];t.addTexture(a,o,i.usages)}for(const i of e.materials||[])t.addMaterial(i);const r=[0];let n=0;for(const i of e.meshes||[]){for(const a of i.primitives){const o={},h=a.mode??4;for(const u in a.attributes){const l=a.attributes[u];o[u]=l}t.addMesh(i.name||"",h,o,a.indices),n++}r.push(n)}const s=e.nodes||[];for(const i of s){const a=t.addNode(i.name||"");let o,h,u;i.matrix?{translation:o,rotation:h,scale:u}=cn(i.matrix):(o=i.translation||[0,0,0],h=i.rotation||[0,0,0,1],u=i.scale||[1,1,1]),t.setNodeScale(a,...u),t.setNodeTranslation(a,...o),t.setNodeRotation(a,...h)}for(let i=0;i<s.length;++i){const a=s[i];for(const o of a.children||[])t.setNodeParent(o,i)}for(const i of e.skins||[])t.addSkin(i.joints,i.inverseBindMatrices,i.skeleton);for(const i of e.animations||[])t.addAnimation(i);for(let i=0;i<s.length;++i){const a=s[i];if(a.mesh!==void 0){const o=r[a.mesh],h=r[a.mesh+1];for(let u=o;u<h;++u){const l=e.meshes[a.mesh].primitives[u-o].material;t.linkNodeMesh(i,u,l,a.skin)}}}t.finish()}var Hn=`#version 300 es

in vec2 POSITION;

out vec2 v_texCoord;

void main()
{
    v_texCoord = POSITION * 0.5 + 0.5;
    gl_Position = vec4(POSITION, 0, 1);
}`;export{Cn as A,Tn as B,Vn as C,K as D,Q as E,In as F,Pn as G,z as H,On as I,ke as J,ze as K,We as L,$n as M,zr as N,te as O,Sn as P,Fn as Q,Un as R,Ae as S,kn as T,qe as U,xn as V,je as W,En as X,Kt as a,Mr as b,Nn as c,Nr as d,R as e,Hn as f,Xn as g,Gr as h,Gn as i,Ln as j,zn as k,Yn as l,Dn as m,Rn as n,ot as o,bn as p,_n as q,Bn as r,ct as s,ut as t,Ar as u,Mn as v,An as w,et as x,vn as y,B as z};
