var ye=Object.defineProperty;var Ne=(t,e,r)=>e in t?ye(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var c=(t,e,r)=>(Ne(t,typeof e!="symbol"?e+"":e,r),r);var ue=1e-6,I=typeof Float32Array<"u"?Float32Array:Array;function Ie(t,e){return Math.abs(t-e)<=ue*Math.max(1,Math.abs(t),Math.abs(e))}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});function fe(){var t=new I(9);return I!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function Se(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}function xe(t,e,r,n,s,i,a,o,h){var m=new I(9);return m[0]=t,m[1]=e,m[2]=r,m[3]=n,m[4]=s,m[5]=i,m[6]=a,m[7]=o,m[8]=h,m}function Dt(t,e,r){var n=e[0],s=e[1],i=e[2],a=e[3],o=e[4],h=e[5],m=e[6],f=e[7],l=e[8],u=r[0],A=r[1];return t[0]=n,t[1]=s,t[2]=i,t[3]=a,t[4]=o,t[5]=h,t[6]=u*n+A*a+m,t[7]=u*s+A*o+f,t[8]=u*i+A*h+l,t}function Ft(t,e,r){var n=r[0],s=r[1];return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=s*e[3],t[4]=s*e[4],t[5]=s*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function Vt(t,e){var r=e[0],n=e[1],s=e[2],i=e[3],a=r+r,o=n+n,h=s+s,m=r*a,f=n*a,l=n*o,u=s*a,A=s*o,_=s*h,d=i*a,b=i*o,p=i*h;return t[0]=1-l-_,t[3]=f-p,t[6]=u+b,t[1]=f+p,t[4]=1-m-_,t[7]=A-d,t[2]=u-b,t[5]=A+d,t[8]=1-m-l,t}function Ct(t,e){var r=e[0],n=e[1],s=e[2],i=e[3],a=e[4],o=e[5],h=e[6],m=e[7],f=e[8],l=e[9],u=e[10],A=e[11],_=e[12],d=e[13],b=e[14],p=e[15],N=r*o-n*a,T=r*h-s*a,w=r*m-i*a,v=n*h-s*o,M=n*m-i*o,D=s*m-i*h,F=f*d-l*_,V=f*b-u*_,R=f*p-A*_,C=l*b-u*d,O=l*p-A*d,P=u*p-A*b,y=N*P-T*O+w*C+v*R-M*V+D*F;return y?(y=1/y,t[0]=(o*P-h*O+m*C)*y,t[1]=(h*R-a*P-m*V)*y,t[2]=(a*O-o*R+m*F)*y,t[3]=(s*O-n*P-i*C)*y,t[4]=(r*P-s*R+i*V)*y,t[5]=(n*R-r*O-i*F)*y,t[6]=(d*D-b*M+p*v)*y,t[7]=(b*w-_*D-p*T)*y,t[8]=(_*M-d*w+p*N)*y,t):null}function z(){var t=new I(16);return I!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function Le(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function J(t,e){var r=e[0],n=e[1],s=e[2],i=e[3],a=e[4],o=e[5],h=e[6],m=e[7],f=e[8],l=e[9],u=e[10],A=e[11],_=e[12],d=e[13],b=e[14],p=e[15],N=r*o-n*a,T=r*h-s*a,w=r*m-i*a,v=n*h-s*o,M=n*m-i*o,D=s*m-i*h,F=f*d-l*_,V=f*b-u*_,R=f*p-A*_,C=l*b-u*d,O=l*p-A*d,P=u*p-A*b,y=N*P-T*O+w*C+v*R-M*V+D*F;return y?(y=1/y,t[0]=(o*P-h*O+m*C)*y,t[1]=(s*O-n*P-i*C)*y,t[2]=(d*D-b*M+p*v)*y,t[3]=(u*M-l*D-A*v)*y,t[4]=(h*R-a*P-m*V)*y,t[5]=(r*P-s*R+i*V)*y,t[6]=(b*w-_*D-p*T)*y,t[7]=(f*D-u*w+A*T)*y,t[8]=(a*O-o*R+m*F)*y,t[9]=(n*R-r*O-i*F)*y,t[10]=(_*M-d*w+p*N)*y,t[11]=(l*w-f*M-A*N)*y,t[12]=(o*V-a*C-h*F)*y,t[13]=(r*C-n*V+s*F)*y,t[14]=(d*T-_*v-b*N)*y,t[15]=(f*v-l*T+u*N)*y,t):null}function me(t,e,r){var n=e[0],s=e[1],i=e[2],a=e[3],o=e[4],h=e[5],m=e[6],f=e[7],l=e[8],u=e[9],A=e[10],_=e[11],d=e[12],b=e[13],p=e[14],N=e[15],T=r[0],w=r[1],v=r[2],M=r[3];return t[0]=T*n+w*o+v*l+M*d,t[1]=T*s+w*h+v*u+M*b,t[2]=T*i+w*m+v*A+M*p,t[3]=T*a+w*f+v*_+M*N,T=r[4],w=r[5],v=r[6],M=r[7],t[4]=T*n+w*o+v*l+M*d,t[5]=T*s+w*h+v*u+M*b,t[6]=T*i+w*m+v*A+M*p,t[7]=T*a+w*f+v*_+M*N,T=r[8],w=r[9],v=r[10],M=r[11],t[8]=T*n+w*o+v*l+M*d,t[9]=T*s+w*h+v*u+M*b,t[10]=T*i+w*m+v*A+M*p,t[11]=T*a+w*f+v*_+M*N,T=r[12],w=r[13],v=r[14],M=r[15],t[12]=T*n+w*o+v*l+M*d,t[13]=T*s+w*h+v*u+M*b,t[14]=T*i+w*m+v*A+M*p,t[15]=T*a+w*f+v*_+M*N,t}function Re(t,e,r,n){var s=e[0],i=e[1],a=e[2],o=e[3],h=s+s,m=i+i,f=a+a,l=s*h,u=s*m,A=s*f,_=i*m,d=i*f,b=a*f,p=o*h,N=o*m,T=o*f,w=n[0],v=n[1],M=n[2];return t[0]=(1-(_+b))*w,t[1]=(u+T)*w,t[2]=(A-N)*w,t[3]=0,t[4]=(u-T)*v,t[5]=(1-(l+b))*v,t[6]=(d+p)*v,t[7]=0,t[8]=(A+N)*M,t[9]=(d-p)*M,t[10]=(1-(l+_))*M,t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function Oe(t,e,r,n,s){var i=1/Math.tan(e/2),a;return t[0]=i/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,s!=null&&s!==1/0?(a=1/(n-s),t[10]=(s+n)*a,t[14]=2*s*n*a):(t[10]=-1,t[14]=-2*n),t}var Pe=Oe,Ue=me;function U(){var t=new I(3);return I!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function te(t){var e=new I(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function De(t){var e=t[0],r=t[1],n=t[2];return Math.hypot(e,r,n)}function L(t,e,r){var n=new I(3);return n[0]=t,n[1]=e,n[2]=r,n}function zt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function Fe(t,e,r,n){return t[0]=e,t[1]=r,t[2]=n,t}function Ve(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t}function Ce(t,e){var r=e[0],n=e[1],s=e[2],i=r*r+n*n+s*s;return i>0&&(i=1/Math.sqrt(i)),t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t}function le(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Y(t,e,r){var n=e[0],s=e[1],i=e[2],a=r[0],o=r[1],h=r[2];return t[0]=s*h-i*o,t[1]=i*a-n*h,t[2]=n*o-s*a,t}function Ae(t,e,r){var n=e[0],s=e[1],i=e[2],a=r[3]*n+r[7]*s+r[11]*i+r[15];return a=a||1,t[0]=(r[0]*n+r[4]*s+r[8]*i+r[12])/a,t[1]=(r[1]*n+r[5]*s+r[9]*i+r[13])/a,t[2]=(r[2]*n+r[6]*s+r[10]*i+r[14])/a,t}function ze(t,e,r){var n=e[0],s=e[1],i=e[2];return t[0]=n*r[0]+s*r[3]+i*r[6],t[1]=n*r[1]+s*r[4]+i*r[7],t[2]=n*r[2]+s*r[5]+i*r[8],t}var H=De;(function(){var t=U();return function(e,r,n,s,i,a){var o,h;for(r||(r=3),n||(n=0),s?h=Math.min(s*r+n,e.length):h=e.length,o=n;o<h;o+=r)t[0]=e[o],t[1]=e[o+1],t[2]=e[o+2],i(t,t,a),e[o]=t[0],e[o+1]=t[1],e[o+2]=t[2];return e}})();function ge(){var t=new I(4);return I!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function Be(t,e){var r=e[0],n=e[1],s=e[2],i=e[3],a=r*r+n*n+s*s+i*i;return a>0&&(a=1/Math.sqrt(a)),t[0]=r*a,t[1]=n*a,t[2]=s*a,t[3]=i*a,t}(function(){var t=ge();return function(e,r,n,s,i,a){var o,h;for(r||(r=4),n||(n=0),s?h=Math.min(s*r+n,e.length):h=e.length,o=n;o<h;o+=r)t[0]=e[o],t[1]=e[o+1],t[2]=e[o+2],t[3]=e[o+3],i(t,t,a),e[o]=t[0],e[o+1]=t[1],e[o+2]=t[2],e[o+3]=t[3];return e}})();function X(){var t=new I(4);return I!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function Ge(t,e,r){r=r*.5;var n=Math.sin(r);return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=Math.cos(r),t}function $e(t,e,r){r*=.5;var n=e[0],s=e[1],i=e[2],a=e[3],o=Math.sin(r),h=Math.cos(r);return t[0]=n*h+a*o,t[1]=s*h+i*o,t[2]=i*h-s*o,t[3]=a*h-n*o,t}function ke(t,e,r){r*=.5;var n=e[0],s=e[1],i=e[2],a=e[3],o=Math.sin(r),h=Math.cos(r);return t[0]=n*h-i*o,t[1]=s*h+a*o,t[2]=i*h+n*o,t[3]=a*h-s*o,t}function Ye(t,e,r){r*=.5;var n=e[0],s=e[1],i=e[2],a=e[3],o=Math.sin(r),h=Math.cos(r);return t[0]=n*h+s*o,t[1]=s*h-n*o,t[2]=i*h+a*o,t[3]=a*h-i*o,t}function j(t,e,r,n){var s=e[0],i=e[1],a=e[2],o=e[3],h=r[0],m=r[1],f=r[2],l=r[3],u,A,_,d,b;return A=s*h+i*m+a*f+o*l,A<0&&(A=-A,h=-h,m=-m,f=-f,l=-l),1-A>ue?(u=Math.acos(A),_=Math.sin(u),d=Math.sin((1-n)*u)/_,b=Math.sin(n*u)/_):(d=1-n,b=n),t[0]=d*s+b*h,t[1]=d*i+b*m,t[2]=d*a+b*f,t[3]=d*o+b*l,t}function Ee(t,e){var r=e[0]+e[4]+e[8],n;if(r>0)n=Math.sqrt(r+1),t[3]=.5*n,n=.5/n,t[0]=(e[5]-e[7])*n,t[1]=(e[6]-e[2])*n,t[2]=(e[1]-e[3])*n;else{var s=0;e[4]>e[0]&&(s=1),e[8]>e[s*3+s]&&(s=2);var i=(s+1)%3,a=(s+2)%3;n=Math.sqrt(e[s*3+s]-e[i*3+i]-e[a*3+a]+1),t[s]=.5*n,n=.5/n,t[3]=(e[i*3+a]-e[a*3+i])*n,t[i]=(e[i*3+s]+e[s*3+i])*n,t[a]=(e[a*3+s]+e[s*3+a])*n}return t}var de=Be;(function(){var t=U(),e=L(1,0,0),r=L(0,1,0);return function(n,s,i){var a=le(s,i);return a<-.999999?(Y(t,e,s),H(t)<1e-6&&Y(t,r,s),Ce(t,t),Ge(n,t,Math.PI),n):a>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(Y(t,s,i),n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=1+a,de(n,n))}})();(function(){var t=X(),e=X();return function(r,n,s,i,a,o){return j(t,n,a,o),j(e,s,i,o),j(r,t,e,2*o*(1-o)),r}})();(function(){var t=fe();return function(e,r,n,s){return t[0]=n[0],t[3]=n[1],t[6]=n[2],t[1]=s[0],t[4]=s[1],t[7]=s[2],t[2]=-r[0],t[5]=-r[1],t[8]=-r[2],de(e,Ee(e,t))}})();function W(){var t=new I(2);return I!=Float32Array&&(t[0]=0,t[1]=0),t}function Q(t,e){var r=new I(2);return r[0]=t,r[1]=e,r}function He(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t}function We(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t}function gt(t,e,r){var n=e[0],s=e[1];return t[0]=r[0]*n+r[3]*s+r[6],t[1]=r[1]*n+r[4]*s+r[7],t}var re=He,Xe=We;(function(){var t=W();return function(e,r,n,s,i,a){var o,h;for(r||(r=2),n||(n=0),s?h=Math.min(s*r+n,e.length):h=e.length,o=n;o<h;o+=r)t[0]=e[o],t[1]=e[o+1],i(t,t,a),e[o]=t[0],e[o+1]=t[1];return e}})();function Z(t){return Object.assign(Object.create(Object.getPrototypeOf(t)),t)}class qe{constructor(e,r,n){c(this,"gl");c(this,"target");this.gl=e,this.target=r,e.bindBuffer(r,n)}unbind(){this.gl.bindBuffer(this.target,null)}data(e,r,n,s){n===void 0?this.gl.bufferData(this.target,e,r):this.gl.bufferData(this.target,e,r,n,s)}vertexAttribPointer(e,r,n,s,i,a){this.gl.vertexAttribPointer(e,r,n,s,i,a),this.gl.enableVertexAttribArray(e)}}class ne{constructor(e,r){c(this,"buffer");c(this,"target");const n=e.createBuffer();this.buffer=n,this.target=r}bind(e){return new qe(e,this.target,this.buffer)}}class je{constructor(e,r){c(this,"gl");e.bindVertexArray(r),this.gl=e}unbind(){this.gl.bindVertexArray(null)}}class Qe{constructor(e){c(this,"vao");const r=e.createVertexArray();this.vao=r}bind(e){return new je(e,this.vao)}}function G(t,e){if(e instanceof Function)return e(t);if(typeof e!="boolean"||!e)throw t}class ee extends Error{constructor(){super("Not implemented yet")}}function be(t,e){switch(e){case t.INT:case t.BOOL:case t.FLOAT:return"scalar";case t.INT_VEC2:case t.INT_VEC3:case t.INT_VEC4:case t.BOOL_VEC2:case t.BOOL_VEC3:case t.BOOL_VEC4:case t.FLOAT_VEC2:case t.FLOAT_VEC3:case t.FLOAT_VEC4:return"vector";case t.FLOAT_MAT2:case t.FLOAT_MAT3:case t.FLOAT_MAT4:return"matrix";case t.SAMPLER_2D:case t.SAMPLER_CUBE:return"sampler";case t.UNSIGNED_INT:return"scalar";case t.UNSIGNED_INT_VEC2:case t.UNSIGNED_INT_VEC3:case t.UNSIGNED_INT_VEC4:return"vector";case t.FLOAT_MAT2x3:case t.FLOAT_MAT2x4:case t.FLOAT_MAT3x2:case t.FLOAT_MAT3x4:case t.FLOAT_MAT4x2:case t.FLOAT_MAT4x3:return"matrix";case t.SAMPLER_3D:case t.SAMPLER_2D_SHADOW:case t.SAMPLER_2D_ARRAY:case t.SAMPLER_2D_ARRAY_SHADOW:case t.SAMPLER_CUBE_SHADOW:case t.INT_SAMPLER_2D:case t.INT_SAMPLER_3D:case t.INT_SAMPLER_CUBE:case t.INT_SAMPLER_2D_ARRAY:case t.UNSIGNED_INT_SAMPLER_2D:case t.UNSIGNED_INT_SAMPLER_3D:case t.UNSIGNED_INT_SAMPLER_CUBE:case t.UNSIGNED_INT_SAMPLER_2D_ARRAY:return"sampler";default:throw new Error(`invalid uniform type: ${e}`)}}function Je(t,e){switch(e){case t.INT:return 1;case t.BOOL:return 1;case t.FLOAT:return 1;case t.INT_VEC2:return 2;case t.BOOL_VEC2:return 2;case t.FLOAT_VEC2:return 2;case t.INT_VEC3:return 3;case t.BOOL_VEC3:return 3;case t.FLOAT_VEC3:return 3;case t.INT_VEC4:return 4;case t.BOOL_VEC4:return 4;case t.FLOAT_VEC4:return 4;case t.FLOAT_MAT2:return 4;case t.FLOAT_MAT3:return 9;case t.FLOAT_MAT4:return 16;case t.SAMPLER_2D:return 1;case t.SAMPLER_CUBE:return 1;case t.UNSIGNED_INT:return 1;case t.UNSIGNED_INT_VEC2:return 2;case t.UNSIGNED_INT_VEC3:return 3;case t.UNSIGNED_INT_VEC4:return 4;case t.FLOAT_MAT2x3:return 6;case t.FLOAT_MAT2x4:return 8;case t.FLOAT_MAT3x2:return 6;case t.FLOAT_MAT3x4:return 12;case t.FLOAT_MAT4x2:return 8;case t.FLOAT_MAT4x3:return 12;case t.SAMPLER_3D:return 1;case t.SAMPLER_2D_SHADOW:case t.SAMPLER_2D_ARRAY:case t.SAMPLER_2D_ARRAY_SHADOW:case t.SAMPLER_CUBE_SHADOW:case t.INT_SAMPLER_2D:case t.INT_SAMPLER_3D:case t.INT_SAMPLER_CUBE:case t.INT_SAMPLER_2D_ARRAY:case t.UNSIGNED_INT_SAMPLER_2D:case t.UNSIGNED_INT_SAMPLER_3D:case t.UNSIGNED_INT_SAMPLER_CUBE:case t.UNSIGNED_INT_SAMPLER_2D_ARRAY:throw new ee;default:throw new Error(`Invalid uniform type: ${e}`)}}function _e(t,e,r){if(r=r||0,r<0||r+e.length>t.size)throw new Error("Invalid offset: "+r);for(let n=0;n<e.length;++n)t.set(e[n],r+n)}class K{constructor(e,r){c(this,"name");c(this,"type");c(this,"size");c(this,"location");c(this,"category");c(this,"numElements");c(this,"values");this.name=r.name,this.type=r.type,this.location=r.location,this.size=r.size,this.numElements=Je(e,r.type),this.category=be(e,r.type),this.values=Array(r.size*this.numElements),this.reset()}bind(e){switch(this.type){case e.FLOAT:return e.uniform1fv(this.location,this.values);case e.BOOL:return e.uniform1iv(this.location,this.values);case e.INT:return e.uniform1iv(this.location,this.values);case e.FLOAT_VEC2:return e.uniform2fv(this.location,this.values);case e.FLOAT_VEC3:return e.uniform3fv(this.location,this.values);case e.FLOAT_VEC4:return e.uniform4fv(this.location,this.values);case e.BOOL_VEC2:return e.uniform2iv(this.location,this.values);case e.INT_VEC2:return e.uniform2iv(this.location,this.values);case e.BOOL_VEC3:return e.uniform3iv(this.location,this.values);case e.INT_VEC3:return e.uniform3iv(this.location,this.values);case e.BOOL_VEC4:return e.uniform4iv(this.location,this.values);case e.INT_VEC4:return e.uniform4iv(this.location,this.values);case e.FLOAT_MAT2:return e.uniformMatrix2fv(this.location,!1,this.values);case e.FLOAT_MAT3:return e.uniformMatrix3fv(this.location,!1,this.values);case e.FLOAT_MAT4:return e.uniformMatrix4fv(this.location,!1,this.values);case e.SAMPLER_2D:return e.uniform1iv(this.location,this.values);case e.SAMPLER_CUBE:return e.uniform1iv(this.location,this.values);case e.UNSIGNED_INT:return e.uniform1uiv(this.location,this.values);case e.UNSIGNED_INT_VEC2:return e.uniform2uiv(this.location,this.values);case e.UNSIGNED_INT_VEC3:return e.uniform3uiv(this.location,this.values);case e.UNSIGNED_INT_VEC4:return e.uniform4uiv(this.location,this.values);case e.FLOAT_MAT2x3:case e.FLOAT_MAT2x4:case e.FLOAT_MAT3x2:case e.FLOAT_MAT3x4:case e.FLOAT_MAT4x2:case e.FLOAT_MAT4x3:case e.SAMPLER_3D:case e.SAMPLER_2D_SHADOW:case e.SAMPLER_2D_ARRAY:case e.SAMPLER_2D_ARRAY_SHADOW:case e.SAMPLER_CUBE_SHADOW:case e.INT_SAMPLER_2D:case e.INT_SAMPLER_3D:case e.INT_SAMPLER_CUBE:case e.INT_SAMPLER_2D_ARRAY:case e.UNSIGNED_INT_SAMPLER_2D:case e.UNSIGNED_INT_SAMPLER_3D:case e.UNSIGNED_INT_SAMPLER_CUBE:case e.UNSIGNED_INT_SAMPLER_2D_ARRAY:return}}set(e,r){switch(r=r||0,this.checkIndex(r),this.category){case"scalar":return this.setScalar(e,r);case"vector":return this.setVector(e,r);case"matrix":return this.setMatrix(e,r);case"sampler":return this.setScalar(e,r);default:throw new ee}}setMany(e,r){_e(this,e,r)}reset(){if(this.values.fill(0),this.category==="vector"&&this.numElements===4)for(let e=0;e<this.size;++e)this.values[this.numElements*e+3]=1;else if(this.category==="matrix"&&this.numElements===16)for(let e=0;e<this.size;++e)this.values[this.numElements*e+15]=1}clone(){const e=Z(this);return e.values=this.values.slice(),e}get(e){return e=e||0,this.checkIndex(e),this.numElements===1?this.values[e]:this.values.slice(this.numElements*e,this.numElements)}checkIndex(e){if(e<0)throw new RangeError(`Negative index: ${e}`);if(e>=this.size)throw new RangeError(`Index should be less than ${this.size}, but ${e}`)}setScalar(e,r){if(typeof e=="number"||typeof e=="boolean")this.values[r]=Number(e);else throw new Error("Invalid type of argument")}setVector(e,r){let n;if(e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint32Array)n=e;else if(Array.isArray(e))e.every(a=>typeof a=="number")?n=e:n=e.map(Number);else if(e&&typeof e=="object"&&Symbol.iterator in e)n=Array.from(e).map(Number);else throw new Error("Invalid type of argument");if(n.length===0)throw new Error("Expected at least one argument");const s=[0,0,0,1];for(let a=0;a<Math.min(n.length,4);++a)s[a]=n[a];s.length=this.numElements;const i=r*this.numElements;for(let a=0;a<this.numElements;++a)this.values[i+a]=s[a]}setMatrix(e,r){let n;if(e instanceof Float32Array)n=e;else if(Array.isArray(e))e.every(i=>typeof i=="number")?n=e:n=e.map(Number);else if(e&&typeof e=="object"&&Symbol.iterator in e)n=Array.from(e).map(Number);else throw new Error("Invalid type of argument");if(n.length!=this.numElements)throw new Error("Matrix size mismatch: expected ${this.numElements} but ${mat.length}");const s=r*this.numElements;for(let i=0;i<n.length;++i)this.values[s+i]=n[i]}}class se{constructor(e,r,n,s){c(this,"textureTarget");c(this,"textures");c(this,"realUniform");if(be(e,r.type)!=="sampler")throw new Error("Invalid uniform info");const i=new K(e,r);for(let a=0;a<r.size;++a){const o=n.length;n.push(null),i.set(o,a)}this.realUniform=i,this.textures=n,this.textureTarget=s}set(e,r){if(e instanceof Te){if(e.target!==this.textureTarget){const n=WebGLDebugUtils.glEnumToString(this.textureTarget),s=WebGLDebugUtils.glEnumToString(e.target);throw new Error(`${n} expected, but got ${s}`)}this.textures[this.realUniform.get(r)]=e}else if(e===null)this.textures[this.realUniform.get(r)]=null;else throw new Error("A texture object was expected")}setMany(e,r){_e(this,e,r)}reset(){for(let e=0;e<this.size;++e)this.textures[this.realUniform.get(e)]=null}bind(e){for(let r=0;r<this.realUniform.size;++r){const n=this.realUniform.get(r);e.activeTexture(e.TEXTURE0+n);const s=this.textures[n];s?s.bind(e):e.bindTexture(this.textureTarget,null)}this.realUniform.bind(e)}clone(){const e=Z(this);return e.realUniform=this.realUniform.clone(),e}get(e){return this.textures[this.realUniform.get(e)]}get size(){return this.realUniform.size}get category(){return this.realUniform.category}get name(){return this.realUniform.name}get type(){return this.realUniform.type}get numElements(){return this.realUniform.numElements}get location(){return this.realUniform.location}}class Bt{constructor(e){c(this,"locators");this.locators=e}}function Ke(t,e,r,n){if(n.some(i=>i.shader===null)||!n.some(i=>i.type===t.VERTEX_SHADER)||!n.some(i=>i.type===t.FRAGMENT_SHADER))return null;const s=t.createProgram();if(!s)return null;for(const i of n)t.attachShader(s,i.shader);for(const i of r.locators)t.bindAttribLocation(s,i.location,i.name);if(t.linkProgram(s),!t.isContextLost()&&!t.getProgramParameter(s,t.LINK_STATUS)){const i=t.getProgramInfoLog(s)??"Program link failed.",a=`${e}: ${i}
`,o=n.map(h=>h.getInfoLog(t)).filter(h=>!!h);throw t.deleteProgram(s),new Error(a+o.join(`

`))}return s}function ie(t,e){switch(e){case t.VERTEX_SHADER:return"vertex";case t.FRAGMENT_SHADER:return"fragment";default:throw new Error("Unkonw shader type code: "+e)}}function Gt(t,e){return new we(t,t.VERTEX_SHADER,e)}function $t(t,e){return new we(t,t.FRAGMENT_SHADER,e)}class we{constructor(e,r,n){c(this,"shader");c(this,"type");c(this,"log");c(this,"source");ie(e,r);const s=e.createShader(r);s&&(e.shaderSource(s,n),e.compileShader(s)),this.shader=s,this.type=r,this.log=null,this.source=n}getInfoLog(e){if(this.shader&&this.source){const r=e.getShaderInfoLog(this.shader);if(r){const n=ie(e,this.type);this.log=`${n} shader
${r}${it(this.source)}`}delete this.source}return this.log}}class kt{constructor(e,r,n,...s){c(this,"name");c(this,"vertexModel");c(this,"program");c(this,"attributes");c(this,"uniforms");const i=new Map,a=new Map,o=Ke(e,r,n,s);if(o){const h=e.getProgramParameter(o,e.ACTIVE_ATTRIBUTES);for(let f=0;f<h;++f){const l=e.getActiveAttrib(o,f);if(l){const u=l.name,A=l.type,_=l.size,d=e.getAttribLocation(o,u),b=n.locators.find(p=>p.name===u);if((b==null?void 0:b.location)!==d)throw Error("program is not compatible with the given vertex model");a.set(u,{name:u,type:A,size:_,location:d,index:f})}}const m=e.getProgramParameter(o,e.ACTIVE_UNIFORMS);for(let f=0;f<m;++f){const l=e.getActiveUniform(o,f);if(l){const u=l.name,A=l.type,_=l.size,d=e.getUniformLocation(o,u);d&&i.set(u,{name:u,type:A,size:_,location:d,index:f})}}}this.program=o,this.uniforms=i,this.attributes=a,this.name=r,this.vertexModel=n}use(e){e.useProgram(this.program)}restore(e){e.useProgram(null)}getAttribLocation(e){const r=this.attributes.get(e);return r?r.location:-1}getUniformLocation(e){const r=this.uniforms.get(e);return r?r.location:null}getUniformInfos(){return Array.from(this.uniforms.values()).sort((e,r)=>e.index-r.index)}}function Ze(t,e,r){const n=t.bind(e);try{r(n)}finally{n.unbind()}}class et{constructor(e,r,n){c(this,"gl");c(this,"target");this.gl=e,this.target=r,this.gl.bindTexture(this.target,n)}unbind(){this.gl.bindTexture(this.target,null)}generateMipmap(){return this.gl.generateMipmap(this.target),this}parameteri(e,r){return this.gl.texParameteri(this.target,e,r),this}}class Te{constructor(e,r,n,s){c(this,"texture");c(this,"target");c(this,"levels");c(this,"internalFormat");if(n<=0)throw new RangeError(`Invalid number of levels: ${n}`);this.texture=e.createTexture(),this.target=r,this.internalFormat=s,this.levels=n}swap(e){if(this.constructor!==e.constructor)throw new Error("Can't swap objects of two distinct types");[this.texture,e.texture]=[e.texture,this.texture],[this.target,e.target]=[e.target,this.target],[this.levels,e.levels]=[e.levels,this.levels],[this.internalFormat,e.internalFormat]=[e.internalFormat,this.internalFormat]}}function ae(t,e){for(let r=0;r<e;++r)t=Math.floor(t/2);return Math.max(1,t)}class tt extends et{constructor(e,r,n){super(e,r,n)}subImage2D(...e){return this.gl.texSubImage2D(...e),this}subImageCube(...e){if(this.target!==this.gl.TEXTURE_CUBE_MAP)throw new Error(`Invalid target for subImageCube: ${this.target}`);const r=[e.pop()].flat();for(let n=0;n<6;++n){const s=r[n%r.length];this.gl.texSubImage2D(this.gl.TEXTURE_CUBE_MAP_POSITIVE_X+n,...e,s)}return this}}class Yt extends Te{constructor(r,n,s,i,a,o){super(r,n,s,i);c(this,"width");c(this,"height");r.bindTexture(this.target,this.texture),r.texStorage2D(this.target,s,i,a,o),r.bindTexture(this.target,null),this.width=a,this.height=o}swap(r){super.swap(r),[this.width,r.width]=[r.width,this.width],[this.height,r.height]=[r.height,this.height]}bind(r){return new tt(r,this.target,this.texture)}}class rt{constructor(e,r){c(this,"gl");c(this,"framebuffer");e.bindFramebuffer(r.target,r.framebuffer),this.gl=e,this.framebuffer=r}texture2D(e,r,n,s){if(this.gl.framebufferTexture2D(this.framebuffer.target,e,r,(n==null?void 0:n.texture)||null,s),n){const i=ae(n.width,s),a=ae(n.height,s);this.framebuffer.attachments.set(e,{size:{width:i,height:a}})}else this.framebuffer.attachments.delete(e);return this}checkStatus(e){return e(this.gl.checkFramebufferStatus(this.framebuffer.target)),this}drawBuffers(...e){return this.gl.drawBuffers(e),this}readPixels(...e){this.gl.readPixels(...e)}unbind(){this.gl.bindFramebuffer(this.framebuffer.target,null)}}class Ht{constructor(e,r){c(this,"framebuffer");c(this,"target");c(this,"attachments");this.framebuffer=e.createFramebuffer(),this.target=r,this.attachments=new Map}bind(e){return new rt(e,this)}get size(){const e={width:0,height:0};return this.attachments.size==0?e:Array.from(this.attachments.values()).map(n=>n.size).reduce((n,s)=>n.width===s.width&&n.height===s.height?n:e)}}function nt(t,e){switch(e){case t.NO_ERROR:return"No error";case t.INVALID_ENUM:return"Invalid enum";case t.INVALID_VALUE:return"Invalid value";case t.INVALID_OPERATION:return"Invalid operation";case t.INVALID_FRAMEBUFFER_OPERATION:return"Invalid framebuffer operation";case t.OUT_OF_MEMORY:return"Out of memory";case t.CONTEXT_LOST_WEBGL:return"Conext lost";case t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"Framebuffer incomplete attachment";case t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"Framebuffer incomplete missing attachment";case t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"Framebuffer incomplete dimensions";case t.FRAMEBUFFER_UNSUPPORTED:return"Framebuffer unsupported";case t.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE:return"Framebuffer incomplete multisample";default:return`Unknwon error: ${e}`}}function st(t,e){switch(e){case t.BYTE:return 1;case t.UNSIGNED_BYTE:return 1;case t.SHORT:return 2;case t.UNSIGNED_SHORT:return 2;case t.INT:return 4;case t.UNSIGNED_INT:return 4;case t.FLOAT:return 4;default:throw new Error("Unknown type")}}class Wt extends Error{constructor(e,r){super(nt(e,r))}}function it(t,e){function r(i,a,o,h){return String(a+1).padStart(o," ")+h+i}const n=t.split(`
`),s=String(n.length).length;return n.map((i,a)=>r(i,a,s,": ")).join(`
`)}function at(t,e,r){switch(e.type){case t.INT:case t.BOOL:case t.FLOAT:case t.INT_VEC2:case t.INT_VEC3:case t.INT_VEC4:case t.BOOL_VEC2:case t.BOOL_VEC3:case t.BOOL_VEC4:case t.FLOAT_VEC2:case t.FLOAT_VEC3:case t.FLOAT_VEC4:case t.FLOAT_MAT2:case t.FLOAT_MAT3:case t.FLOAT_MAT4:return new K(t,e);case t.SAMPLER_2D:return new se(t,e,r,t.TEXTURE_2D);case t.SAMPLER_CUBE:return new se(t,e,r,t.TEXTURE_CUBE_MAP);case t.UNSIGNED_INT:case t.UNSIGNED_INT_VEC2:case t.UNSIGNED_INT_VEC3:case t.UNSIGNED_INT_VEC4:return new K(t,e);case t.FLOAT_MAT2x3:case t.FLOAT_MAT2x4:case t.FLOAT_MAT3x2:case t.FLOAT_MAT3x4:case t.FLOAT_MAT4x2:case t.FLOAT_MAT4x3:case t.SAMPLER_3D:case t.SAMPLER_2D_SHADOW:case t.SAMPLER_2D_ARRAY:case t.SAMPLER_2D_ARRAY_SHADOW:case t.SAMPLER_CUBE_SHADOW:case t.INT_SAMPLER_2D:case t.INT_SAMPLER_3D:case t.INT_SAMPLER_CUBE:case t.INT_SAMPLER_2D_ARRAY:case t.UNSIGNED_INT_SAMPLER_2D:case t.UNSIGNED_INT_SAMPLER_3D:case t.UNSIGNED_INT_SAMPLER_CUBE:case t.UNSIGNED_INT_SAMPLER_2D_ARRAY:default:throw new ee}}class Xt{constructor(e,r,n){c(this,"name");c(this,"program");c(this,"uniforms");c(this,"textures");c(this,"queue");const s=new Map,i=[];for(const o of r.getUniformInfos())s.set(o.name,at(e,o,i));const a=Object.entries((n==null?void 0:n.aliases)||{});this.name=(n==null?void 0:n.name)??r.name,this.queue=(n==null?void 0:n.queue)??0,this.program=r,this.uniforms=s,this.textures=i;for(const[o,h]of a)if(!this.addAlias(o,h)&&!(n!=null&&n.quiet))throw new Error(`No such uniform: ${h}`);this.setUniformValues((n==null?void 0:n.uniforms)??{},n==null?void 0:n.quiet)}use(e){this.program.use(e);for(const r of this.uniforms.values())r.bind(e)}restore(e){this.program.restore(e)}addAlias(e,r){const n=this.uniforms.get(r);return n&&this.uniforms.set(e,n),n}removeAlias(e){const r=this.uniforms.get(e);if(r&&r.name!==e)return this.uniforms.delete(e),r}*getAliases(){for(const[e,r]of this.uniforms.entries())r.name!==e&&(yield[e,r.name])}getUniform(e){return this.uniforms.get(e)}*getUniforms(e=!1){for(const[r,n]of this.uniforms.entries())(e||n.name===r)&&(yield n)}setUniformValue(e,r,n,s){const i=/^(.*)\[(\d+)\]$/,a=e.match(i);if(n===void 0)if(a)n=Number(a[2]),isNaN(n)&&G(new Error(`Invalid uniform name: ${e}`),s),n===0?this.doSetUniformValue(e,r,0,s):this.doSetUniformValue(a[1]+"[0]",r,n,s);else if(Array.isArray(r)&&this.uniforms.has(e+"[0]"))for(let o=0;o<r.length;++o)this.doSetUniformValue(e+"[0]",r[o],o,s);else this.doSetUniformValue(e,r,0,s);else a&&G(new Error("Invalid call: given a redundant index"),s),this.uniforms.has(e+"[0]")?this.doSetUniformValue(e+"[0]",r,n,s):n===0?this.doSetUniformValue(e,r,0,s):G(new Error(`${e} is not an array`),s)}setUniformValues(e,r){for(const n in e)this.setUniformValue(n,e[n],void 0,r)}clone(e){const r=Z(this);r.textures=this.textures.slice(),r.name=(e==null?void 0:e.name)??this.name,r.queue=(e==null?void 0:e.queue)??this.queue,r.uniforms=new Map;for(const[n,s]of this.uniforms)r.uniforms.set(n,s.clone());return r.setUniformValues((e==null?void 0:e.uniforms)??{},e==null?void 0:e.quiet),r}doSetUniformValue(e,r,n,s){const i=this.uniforms.get(e);i?i.set(r,n):G(new Error(`No such uniform: ${e}`),s)}}function qt(t,e){const r={};for(const s in e.attributes){const i=e.attributes[s],a=new ne(t,t.ARRAY_BUFFER);a.bind(t).data(i.buffer,t.STATIC_DRAW),r[s]={...i,buffer:a}}let n;if(e.indices){const s=e.indices,i=new ne(t,t.ELEMENT_ARRAY_BUFFER);i.bind(t).data(s.buffer,t.STATIC_DRAW),n={...s,buffer:i}}return{...e,attributes:r,indices:n}}class jt{constructor(e,r,n){c(this,"geometry");c(this,"subMeshes");c(this,"vertexModel");c(this,"vao");var a;const s=r.segments||[{offset:0,count:((a=r.indices)==null?void 0:a.count)??ot(r)}],i=new Qe(e);Ze(i,e,o=>{for(const[h,m]of Object.entries(r.attributes)){const f=n.locators.find(l=>l.name===h);f&&m.buffer.bind(e).vertexAttribPointer(f.location,m.size||1,m.type,!!m.normalized,m.stride||0,m.offset||0)}r.indices&&r.indices.buffer.bind(e)}),this.geometry=r,this.subMeshes=s,this.vertexModel=n,this.vao=i}draw(e,r){const n=this.vao.bind(e),s=this.subMeshes[r],i=this.geometry.indices;if(i){const a=(i.offset||0)+s.offset*st(e,i.type);e.drawElements(this.geometry.drawMode,s.count,i.type,a)}else e.drawArrays(this.geometry.drawMode,s.offset,s.count);n.unbind()}}function ot(t){const e=Object.values(t.attributes).map(r=>r.count);if(!e.length)throw new Error("No attributes are given");if(!e.every(r=>r===e[0]))throw new Error("All attributes must have the same count");return e[0]}function oe(t){return t/180*Math.PI}function ct(t){return t/Math.PI*180}function $(t,e,r){return Math.max(e,Math.min(t,r))}class g{constructor(e,r,n,s){c(this,"x");c(this,"y");c(this,"w");c(this,"h");this.x=e,this.y=r,this.w=n,this.h=s}denormalize(e,r){return new g(this.x*e,this.y*r,this.w*e,this.h*r)}validate(){let e=this.x,r=this.y,n=this.w,s=this.h;return n<0&&([e,n]=[e+n,-n]),s<0&&([r,s]=[r+s,-s]),new g(e,r,n,s)}clip(e){let r=$(this.left,e.left,e.right),n=$(this.bottom,e.bottom,e.top),s=$(this.right,e.left,e.right),i=$(this.top,e.bottom,e.top);return new g(r,n,s-r,i-n)}map(e){return new g(e(this.x),e(this.y),e(this.w),e(this.h))}get right(){return this.x+this.w}get top(){return this.y+this.h}get left(){return this.x}get bottom(){return this.y}get aspectRatio(){return this.w/this.h}}class q{constructor(e,r){c(this,"value");r==="deg"?this.value=oe(e):this.value=e}static rad(e){return new q(e,"rad")}static deg(e){return new q(e,"deg")}fromRad(e){this.value=e}fromDeg(e){this.value=oe(e)}toRad(){return this.value}toDeg(){return ct(this.value)}}function ht(t,e,r){const n=X();return ke(n,n,e.toRad()),$e(n,n,t.toRad()),Ye(n,n,r.toRad()),n}class ut{constructor(){c(this,"translation");c(this,"rotation");c(this,"scale");this.translation=U(),this.rotation=U(),this.scale=U(),Fe(this.scale,1,1,1)}matrix(e){const r=Array.from(this.rotation).map(q.deg),n=ht(r[0],r[1],r[2]);Re(e,n,this.translation,this.scale)}}class Qt{constructor(e,r){c(this,"parent");c(this,"name");c(this,"trs");c(this,"localMatrix");c(this,"globalMatrix");c(this,"take");c(this,"enabled");c(this,"components");this.parent=e,this.name=r,this.trs=new ut,this.localMatrix=z(),this.globalMatrix=z(),this.take=0,this.enabled=!0,this.components=new Set}preUpdate(e,r){var n;if(this.enabled)for(const s of this.components)(n=s.preUpdate)==null||n.call(s,this,e,r)}update(e){this.take!==e&&(this.trs.matrix(this.localMatrix),this.parent?(this.parent.update(e),me(this.globalMatrix,this.parent.globalMatrix,this.localMatrix)):Le(this.globalMatrix,this.localMatrix),this.take=e)}postUpdate(){var e;if(this.enabled)for(const r of this.components)(e=r.postUpdate)==null||e.call(r,this)}addComponent(e){this.components.add(e)}removeComponent(e){return this.components.delete(e)}get position(){return Ae(U(),U(),this.globalMatrix)}get forward(){const e=L(0,0,-1),r=Se(fe(),this.globalMatrix);return ze(U(),e,r)}}class Jt{constructor(e,r,n){c(this,"fovy");c(this,"near");c(this,"far");this.fovy=e,this.near=r,this.far=n}matrix(e,r){return Pe(e,this.fovy.toRad(),r,this.near,this.far)}}class ft{constructor(e,r,n,s){c(this,"view");c(this,"proj");c(this,"position");c(this,"inverseView");c(this,"inverseProj");n||(n=z(),e&&J(n,e)),s||(s=z(),r&&J(s,r));const i=Ae(U(),L(0,0,0),n);this.view=e??z(),this.proj=r??z(),this.position=i,this.inverseView=n,this.inverseProj=s}get inverseViewProj(){return Ue(z(),this.inverseView,this.inverseProj)}}class Kt{constructor(e,r,n){c(this,"node");c(this,"order");c(this,"normalizedViewportRect");c(this,"cullMask");c(this,"projection");this.node=e,this.order=r,this.projection=n,this.normalizedViewportRect=new g(0,0,1,1),this.cullMask=2147483647}update(e){this.node.update(e)}viewport(e,r){const n=new g(0,0,e,r);return this.normalizedViewportRect.validate().denormalize(n.w,n.h).clip(n)}prepare(e){Number.isFinite(e)||(e=1);const r=z();J(r,this.node.globalMatrix);const n=z();return this.projection.matrix(n,e),new ft(r,n,this.node.globalMatrix)}}class ve{}class mt extends ve{constructor(r){super();c(this,"typeTag");this.typeTag=r}check(r,n){r===void 0||x(r,this.typeTag,n)}}function E(t){return new mt(t)}class pe{constructor(e){c(this,"parent");this.parent=e}toString(){return(this.parent?this.parent.toString():"")+this.toStringSelf()}}class lt extends pe{constructor(r,n){super(n);c(this,"name");this.name=r}toStringSelf(){return"."+this.name}}class At extends pe{constructor(r,n){super(n);c(this,"index");this.index=r}toStringSelf(){return"["+this.index+"]"}}function x(t,e,r){function n(){return r?r.toString()+": ":""}if(e instanceof ve)e.check(t,r);else if(typeof e=="string")switch(e){case"number":case"boolean":case"string":if(typeof t!==e)throw new Error(`${n()}${t} is not a ${e}`);break;default:throw new Error(`unsupported type tag: ${e}`)}else if(Array.isArray(e)){if(!Array.isArray(t))throw new Error(`${n()}${t} is not an array`);if(e.length===1)for(let s=0;s<t.length;++s)x(t[s],e[0],new At(s,r));else if(e.length>1)throw new Error("tuple is not supported")}else if(e&&typeof e=="object"){if(!t||typeof t!="object")throw new Error(`${n()}${t} is not an object`);for(const s in e)x(t[s],e[s],new lt(s,r))}}const Et=34962,dt=34963,bt=5120,_t=5121,wt=5122,Tt=5123,vt=5125,pt=5126;function Mt(t){try{if(x(t,{asset:{version:"string",copyright:E("string"),generator:E("string"),minVersion:E("string")},extensionsUsed:E(["string"]),extensionsRequired:E(["string"]),scene:E("number")}),t.accessors&&x(t.accessors,[{componentType:"number",count:"number",type:"string",bufferView:E("number"),byteOffset:E("number"),normalized:E("boolean"),max:E(["number"]),min:E(["number"]),sparse:E({}),name:E("string"),extensions:E({})}]),t.animations&&x(t.animations,[{channels:[{sampler:"number",target:{node:E("number"),path:"string",extensions:E({})},extensions:E({})}],samplers:[{input:"number",interpolation:E("string"),output:"number",extensions:E({})}],name:E("string"),extensions:E({})}]),t.buffers&&x(t.buffers,[{uri:E("string"),byteLength:"number",name:E("string"),extensions:E({})}]),t.bufferViews&&x(t.bufferViews,[{buffer:"number",byteOffset:E("number"),byteLength:"number",byteStride:E("number"),target:E("number"),name:E("string"),extensions:E({})}]),t.cameras&&x(t.cameras,[{orthographic:E({xmag:"number",ymag:"number",zfar:"number",znear:"number",extensions:E({})}),perspective:E({aspectRatio:E("number"),yfov:"number",zfar:E("number"),znear:"number",extensions:E({})}),type:"string",name:E("string"),extensions:E({})}]),t.meshes){x(t.meshes,[{primitives:[{attributes:{},indices:E("number"),material:E("number"),mode:E("number"),targets:E([{}]),extensions:E({})}],weights:E(["number"]),name:E("string"),extensions:E({})}]);for(const e of t.meshes)for(const r of e.primitives)if(!Object.values(r.attributes).every(n=>typeof n=="number"))throw new Error("mesh.primitive.attributes must have only number values")}if(t.nodes){x(t.nodes,[{camera:E("number"),children:E(["number"]),skin:E("number"),matrix:E(["number"]),mesh:E("number"),rotation:E(["number"]),scale:E(["number"]),translation:E(["number"]),weights:E(["number"]),name:E("string"),extensions:E({})}]);for(const e of t.nodes){if(e.matrix&&e.matrix.length!=16)throw new Error("node.matrix must have 16 elements");if(e.rotation&&e.rotation.length!=4)throw new Error("node.rotation must have 4 elements");if(e.scale&&e.scale.length!=3)throw new Error("node.scale must have 3 elements");if(e.translation&&e.translation.length!=3)throw new Error("node.translation must have 3 elements")}}return t.scenes&&x(t.scenes,[{node:E(["number"]),name:E("string"),extensions:E({})}]),t}catch(e){const r="Inavild glTF file: ";throw e instanceof Error?(e.message=r+e.message,e):new Error("Invalid glTF file: "+String(e))}}function yt(t){return Nt(t)*t.count}function Nt(t){const[e,r]=Me(t.type);return St(e*It(t.componentType),4)*r}function It(t){switch(t){case bt:return 1;case _t:return 1;case wt:return 2;case Tt:return 2;case vt:return 4;case pt:return 4;default:throw new Error("Invalid component type code: "+t)}}function Zt(t){const[e,r]=Me(t);return e*r}function St(t,e){const r=t+(e-1),n=r%e;return r-n}function Me(t){switch(t){case"SCALAR":return[1,1];case"VEC2":return[2,1];case"VEC3":return[3,1];case"VEC4":return[4,1];case"MAT2":return[2,2];case"MAT3":return[3,3];case"MAT4":return[4,4];default:throw new Error("Invalid accessor type: "+t)}}function er(t){const e=L(t[12],t[13],t[14]),r=[L(t[0],t[1],t[2]),L(t[4],t[5],t[6]),L(t[8],t[9],t[10])],n=L(H(r[0]),H(r[1]),H(r[2])),s=Y(U(),r[0],r[1]);le(s,r[2])<0&&(n[2]=-n[2]);for(let o=0;o<3;++o)Ie(n[o],0)||Ve(r[o],r[o],1/n[o]);const a=Ee(X(),xe(r[0][0],r[0][1],r[0][2],r[1][0],r[1][1],r[1][2],r[2][0],r[2][1],r[2][2]));return{translation:[e[0],e[1],e[2]],rotation:[a[0],a[1],a[2],a[3]],scale:[n[0],n[1],n[2]]}}function tr(t,e){if(e.bufferView!==void 0)return t.bufferViews[e.bufferView].byteStride}function xt(t){return async function(e){if(!e.uri)throw new Error("Can't fetch buffer data. URI not found");const r=new URL(e.uri,t),n=await fetch(r);if(!n.ok)throw new Error("failed to fetch data from: "+e.uri);return n.arrayBuffer()}}async function Lt(t,e,r){var m;const n=(t.buffers||[]).map(e),i=(await Promise.all(n)).map((f,l)=>{const u=t.buffers[l];if(f.byteLength<u.byteLength)throw new Error(`fetched data is smaller(${f.byteLength}) than expected(${u.byteLength})`);return{...u,data:f}});console.assert(i.length===(((m=t.buffers)==null?void 0:m.length)||0));const a=(t.bufferViews||[]).map(f=>({...f})),o=(t.accessors||[]).map(f=>({...f,bufferView:f.bufferView??-1}));for(const f of o)if(f.bufferView===-1){const l=yt(f),u=new ArrayBuffer(l),A={byteLength:l,data:u};r&&r(f,u);const _={buffer:i.length,byteLength:l};f.bufferView=a.length,i.push(A),a.push(_)}for(const f of t.meshes||[])for(const l of f.primitives){for(const u of Object.values(l.attributes)){const A=o[u];a[A.bufferView].target=Et}if(l.indices!=null){const u=o[l.indices];a[u.bufferView].target=dt}}return{...t,buffers:i,bufferViews:a,accessors:o}}class ce extends Error{constructor(e){super(e)}}class rr{constructor(){c(this,"ticket");this.ticket={}}dispose(e){this.ticket.errorMessage=e,this.ticket={}}checkTicket(e){if(e!==this.ticket)throw new ce(e.errorMessage)}loadImage(e){return new Promise((r,n)=>{const s=this.ticket,i=new Image;i.onerror=n,i.onload=()=>{s!==this.ticket?n(new ce(s.errorMessage)):r(i)},i.src=e})}async loadImageBitmap(e,r){const n=this.ticket,s=await this.loadImage(e),i=await createImageBitmap(s,r);return this.checkTicket(n),i}async loadImageBitmapCube(e,r){const n=this.ticket,s=await Promise.all(e.map(i=>this.loadImageBitmap(i,r)));return this.checkTicket(n),s}async loadGltf(e){const r=this.ticket,n=await fetch(e);if(!n.ok)throw new Error("failed to fetch: "+e);const s=await n.text();this.checkTicket(r);const i=JSON.parse(s),a=await Lt(Mt(i),xt(e));return this.checkTicket(r),a}}const B=4,Rt=5123,k=5125,S=5126;class Ot{constructor(e,r){c(this,"min");c(this,"max");this.min=e,this.max=r}normalize(e){const r=re(W(),this.max,this.min),n=re(W(),e,this.min);return Xe(W(),n,r)}}class nr{static createSphere(e,r,n,s){n=Math.max(3,n),s=Math.max(2,s);const i=Math.PI,a=(s+1)*(n+1),o=[],h=[],m=[];for(let l=0;l<=s;++l)for(let u=0;u<=n;++u){const A=u/n*2*i,_=-i/2+l/s*i,d=Math.cos(_),b=Math.sin(_),p=Math.cos(A),N=Math.sin(A),T=d*p,w=b,v=-d*N;h.push(T,w,v),o.push(T*r,w*r,v*r),m.push(u/n,l/s)}const f=[];for(let l=0;l<s;++l)for(let u=0;u<n;++u){const A=l*(n+1)+u,_=A+1,d=A+n+1,b=d+1;l!==0&&f.push(A,_,d),l!=s-1&&f.push(d,_,b)}return{name:e,attributes:{POSITION:{buffer:new Float32Array(o),size:3,type:S,count:a},TEXCOORD_0:{buffer:new Float32Array(m),size:2,type:S,count:a},NORMAL:{buffer:new Float32Array(h),size:3,type:S,count:a}},indices:{buffer:new Uint32Array(f),type:k,count:f.length},drawMode:B}}static createCube(e,r,n,s){s=s??[0,0,0];const i=[[-.5,.5,-.5],[-.5,.5,.5],[.5,.5,.5],[.5,.5,-.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,-.5,.5],[-.5,-.5,.5],[-.5,.5,.5],[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[.5,.5,-.5],[.5,-.5,-.5],[-.5,-.5,-.5],[-.5,.5,-.5],[.5,.5,.5],[.5,-.5,.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5],[-.5,-.5,-.5],[-.5,-.5,.5],[-.5,.5,.5]],a=[[0,0],[0,1],[1,1],[1,0],[0,0],[1,0],[1,1],[0,1],[0,1],[0,0],[1,0],[1,1],[1,1],[1,0],[0,0],[0,1],[1,1],[0,1],[0,0],[1,0],[1,0],[0,0],[0,1],[1,1]];let o=[[0,1,0],[0,1,0],[0,1,0],[0,1,0],[0,-1,0],[0,-1,0],[0,-1,0],[0,-1,0],[0,0,1],[0,0,1],[0,0,1],[0,0,1],[0,0,-1],[0,0,-1],[0,0,-1],[0,0,-1],[1,0,0],[1,0,0],[1,0,0],[1,0,0],[-1,0,0],[-1,0,0],[-1,0,0],[-1,0,0]],h=[[1,0,0,-1],[1,0,0,-1],[1,0,0,-1],[1,0,0,-1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,-1],[1,0,0,-1],[1,0,0,-1],[1,0,0,-1],[0,1,0,1],[0,1,0,1],[0,1,0,1],[0,1,0,1],[0,1,0,-1],[0,1,0,-1],[0,1,0,-1],[0,1,0,-1]];const m=[0,1,2,2,3,0,4,5,6,6,7,4,8,9,10,10,11,8,12,13,14,14,15,12,16,17,18,18,19,16,20,21,22,22,23,20];r&&(m.reverse(),o=o.map(u=>u.map(A=>-1*A)),h=h.map(u=>[u[0],u[1],u[2],-u[3]]));function f(u,A){return[u[0]*A[0],u[1]*A[1],u[2]*A[2]]}function l(u,A){return[u[0]+A[0],u[1]+A[1],u[2]+A[2]]}return{name:e,attributes:{POSITION:{buffer:new Float32Array(i.map(u=>l(s,f(u,n))).flat()),size:3,type:S,count:24},TEXCOORD_0:{buffer:new Float32Array(a.flat()),size:2,type:S,count:24},NORMAL:{buffer:new Float32Array(o.flat()),size:3,type:S,count:24}},indices:{buffer:new Uint32Array(m),type:k,count:36},drawMode:B}}static createQuad(e){const r=[-1,-1,1,-1,1,1,-1,1],n=r.map(a=>a*.5+.5),s=[0,0,1,0,0,1,0,0,1,0,0,1],i=[0,1,2,2,3,0];return{name:e,attributes:{POSITION:{buffer:new Float32Array(r),size:2,type:S,count:4},TEXCOORD_0:{buffer:new Float32Array(n),size:2,type:S,count:4},NORMAL:{buffer:new Float32Array(s),size:3,type:S,count:4}},indices:{buffer:new Uint16Array(i),type:Rt,count:6},drawMode:B}}static createBackdrop(e){const r=[-1,-1,1,1,-1,1,1,1,1,-1,1,1],n=[0,1,2,2,3,0];return{name:e,attributes:{POSITION:{buffer:new Float32Array(r),size:3,type:S,count:4}},indices:{buffer:new Uint32Array(n),type:k,count:6},drawMode:B}}static createPlane(e,r,n,s){if(s<1)throw new Error(`slices should be greater than or equal to 1, but ${s}`);s=Math.floor(s);const i=L(-r/2,-n/2,0),a=L(r/2,n/2,0),o=r/s,h=n/s,m=te(i),f=[],l=[],u=new Ot(Q(i[0],i[1]),Q(a[0],a[1]));for(let b=0;b<s+1;++b){m[0]=i[0];for(let p=0;p<s+1;++p)f.push(te(m)),l.push(u.normalize(Q(m[0],m[1]))),m[0]+=o;m[1]+=h}const A=L(0,0,1),_=Array(f.length).fill(A),d=[];for(let b=0;b<s;++b)for(let p=0;p<s;++p){let N=(s+1)*b+p,T=N+1,w=N+(s+1),v=w+1;d.push(N),d.push(T),d.push(w),d.push(w),d.push(T),d.push(v)}return{name:e,attributes:{POSITION:{buffer:new Float32Array(f.map(b=>Array.from(b)).flat()),size:3,type:S,count:f.length},TEXCOORD_0:{buffer:new Float32Array(l.map(b=>Array.from(b)).flat()),size:2,type:S,count:f.length},NORMAL:{buffer:new Float32Array(_.map(b=>Array.from(b)).flat()),size:3,type:S,count:f.length}},indices:{buffer:new Uint32Array(d),type:k,count:d.length},drawMode:B}}}function he(t,e){return[t[0]-e[0],t[1]-e[1]]}function Pt(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}class sr{constructor(e,r){c(this,"clickPos");c(this,"currentPos");c(this,"pointerId");c(this,"trails");c(this,"dragging");c(this,"count");c(this,"threshold");c(this,"onDrag");this.trails=0,this.dragging=!1,this.count=-1,this.threshold=r??2,this.onDrag=e}pointerDown(e){this.clickPos===void 0&&(this.currentPos=this.clickPos=[e.clientX,e.clientY],this.pointerId=e.pointerId)}pointerUp(e){this.clickPos===void 0||this.pointerId!==e.pointerId||(this.onDrag({pointerId:e.pointerId,startPos:this.clickPos,currentPos:this.currentPos,delta:[0,0],done:!0,count:this.count+1}),delete this.clickPos,delete this.currentPos,delete this.pointerId,this.trails=0,this.dragging=!1)}pointerMove(e){if(this.clickPos===void 0)return;const r=this.currentPos;this.currentPos=[e.clientX,e.clientY];const n=he(this.currentPos,r);this.trails+=Pt(n),this.dragging?(this.count++,this.onDrag({pointerId:e.pointerId,startPos:this.clickPos,currentPos:this.currentPos,delta:n,done:!1,count:this.count})):this.trails>this.threshold&&(this.dragging=!0,this.count=0,this.onDrag({pointerId:e.pointerId,startPos:this.clickPos,currentPos:this.currentPos,delta:he(this.currentPos,this.clickPos),done:!1,count:0}))}}var ir=`#version 300 es

in vec2 POSITION;

out vec2 v_texCoord;

void main()
{
    v_texCoord = POSITION * 0.5 + 0.5;
    gl_Position = vec4(POSITION, 0, 1);
}`;export{rr as A,ne as B,Kt as C,Ft as D,Q as E,Ht as F,Wt as G,Dt as H,gt as I,W as J,Y as K,U as L,Xt as M,Qt as N,Ce as O,sr as P,De as Q,Ge as R,we as S,Yt as T,Bt as V,kt as a,qt as b,jt as c,L as d,tr as e,ir as f,er as g,zt as h,z as i,$ as j,nr as k,Ct as l,fe as m,Zt as n,Le as o,Ue as p,Jt as q,q as r,ct as s,$t as t,Ze as u,Gt as v,ke as w,X as x,$e as y,Vt as z};
